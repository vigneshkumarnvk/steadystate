<aura:component controller="ACVSalesLineController" extends="c:SalesOrderBase">
    <!--attributes-->
    <aura:attribute name="salesLine" type="Object" access="public"/>
    <!--ticket 19130-->
    <!--
    <aura:attribute name="parentLineOptions" type="List" default="[]" access="private"/>
    <aura:attribute name="selectedParentLineNo" type="String" default="" access="private"/>
    -->
    <!--ticket 19130-->
    <aura:attribute name="jobTaskWrapper" type="Object" access="public"/>
    <aura:attribute name="jobTasks" type="List" access="public" description="all job tasks on the sales order"/>
    <aura:attribute name="mode" type="String" access="public"/>
    <aura:attribute name="linesAdded" type="Boolean" access="public"/>
    <aura:attribute name="nextSalesLineNo" type="Integer" access="public"/>
    <aura:attribute name="updateTotals" type="Boolean" access="private"/>
    <aura:attribute name="xFields" type="Object" access="private"/>
    <aura:attribute name="presumptiveChildLines" type="List" access="private"/>
    <aura:attribute name="taxGroupOptions" type="List" default="[{'label': 'NT', 'value': 'NT'}, {'label': 'TX', 'value': 'TX'}]"/>
    <aura:attribute name="markupOptions" type="List" default="[{'label': '%', 'value': '%'}, {'label': 'Amount', 'value': 'Amount'}]"/>
    <aura:attribute name="costMethodOptions" type="List" default="[{'label': 'Unit Wt/Vol', 'value': 'Unit_Weight_Vol'}, {'label': 'Container', 'value': 'Container'}]"/>
    <aura:attribute name="costPlusMESResourceId" type="String" />
    <aura:attribute name="prvUnitPrice" type="Double" access="public" default="0"/>
    <aura:attribute name="prvxUnitPrice" type="Double" access="public" default="0"/>
    <aura:attribute name="uomItems" type="List" access="public"/>
     
    <!--events-->
    
    <!--handlers-->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="change" value="{!v.salesLine}" action="{!c.handleSalesLineChange}"/>
    
    <!--methods-->
    <aura:method name="validateFields" action="{!c.validateFields}"/>
    <aura:method name="saveSalesLine" action="{!c.saveSalesLine}">
        <aura:attribute name="callback" type="Function"/>
    </aura:method>
    
    <!--ticket 19130-->
    <p class="slds-p-horizontal_small">
        <lightning:layout>
            <lightning:layoutItem flexibility="auto">
                <!--ticket 19130-->
                
                <lightning:card title="{!'Task ' + v.jobTaskWrapper.JobTask.Task_No__c + ' - ' + v.jobTaskWrapper.JobTask.Name}">
                    <!--ticket 19130-->
                    <!--<p class="slds-p-horizontal_small">-->
                    <!--ticket 19130-->
                    <lightning:layout multipleRows="true">
                        <!--left panel-->
                        <lightning:layoutItem size="7" padding="around-small">
                            <lightning:layout multipleRows="true">
                                <!-- Field: Category-->
                                <lightning:layoutItem size="6" padding="horizontal-small">
                                    <lightning:select aura:id="category" label="Category"
                                                      value="{!v.salesLine.Category__c}"
                                                      disabled="{!v.xFields.Category.disabled == true || v.salesLine.Rolled_up_Unit_Price__c > 0
                                                                || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval'
                                                                || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                      onchange="{!c.handleCategoryChange}"
                                                      required="{!v.xFields.Category.required}"
                                                      messageWhenValueMissing="This field is mandatory">
                                        <option value=""></option>
                                        <option value="Labor">Labor</option>
                                        <option value="Equipment">Equipment</option>
                                        <option value="Materials">Materials</option>
                                        <option value="Subcontractors">Cost Plus Materials, Equipment and Services</option>
                                        <option value="Waste Disposal">Waste Disposal</option>
                                        <option value="Demurrage">Transportation, Demurrage and Fees</option>
                                        <option value="Bundled">Bundled</option>
                                        <option value="Misc. Charges And Taxes">Misc. Charges And Taxes</option>
                                    </lightning:select>
                                </lightning:layoutItem>
                                <!-- Field: Category-->
                                
                                <!-- Field: Facility-->
                                <aura:if isTrue="{!v.xFields.Facility.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!$Label.c.Release_Flag == 'true'}">
                                            <c:LookupInputFacility aura:id="facility" label="Facility"
                                                                   value="{!v.salesLine.Facility__r}"
                                                                   SObjectName="Facility__c"
                                                                   queryFields="['Third_Party_Facility__c','EPA_ID__c','Postal_Code__c','Country__c']"
                                                                   columns="[{label: 'TSDF Code', fieldName: 'TSDF_Code__c'}, {label: 'TSDF Name', fieldName: 'Name'},{label: 'Address', fieldName: 'Street__c'},{label: 'City', fieldName: 'City__c'},{label: 'State', fieldName: 'State__c'}]"
                                                                   filter="TSDF_Status__c='A'"
                                                                   pill="{iconName: 'standard:household', fieldName: 'Name'}"
                                                                   onchange="{!c.handleFacilityChange}"
                                                                   disabled="{!v.xFields.Facility.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                             || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                                   required="{!v.xFields.Facility.required}"
                                                                   messageWhenValueMissing="This field is mandatory."/>
                                            <aura:set attribute="else">
                                                <c:LookupInput aura:id="facility" label="Facility"
                                                               value="{!v.salesLine.Facility__r}"
                                                               SObjectName="Facility__c"
                                                               queryFields="['Third_Party_Facility__c']"
                                                               columns="[{label: 'Name', fieldName: 'Name'}]"
                                                               pill="{iconName: 'standard:household', fieldName: 'Name'}"
                                                               onchange="{!c.handleFacilityChange}"
                                                               required="{!v.xFields.Facility.required}"
                                                               messageWhenValueMissing="This field is mandatory."/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                    
                                </aura:if>
                                <!-- Field: Facility-->
                                
                                <!-- Field: Resource Type-->
                                <aura:if isTrue="{!v.xFields.ResourceType.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LookupInput aura:id="resource-type" label="Resource Type"
                                                       value="{!v.salesLine.Resource_Type__r}"
                                                       SObjectName="Resource_Type__c"
                                                       columns="[{label: 'Name', fieldName: 'Name', 'class': 'slds-cell-wrap'}, {label: 'Description', fieldName: 'Description__c', 'class': 'slds-cell-wrap'}]"
                                                       filter="{!'Category__c=\'' + v.salesLine.Category__c + '\' AND Blocked__c!=TRUE'}"
                                                       pill="{iconName: 'standard:work_type', fieldName: 'Name'}"
                                                       disabled="{!v.xFields.ResourceType.disabled == true || v.salesLine.Category__c == ''
                                                                 || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval'
                                                                 || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                       onchange="{!c.handleResourceTypeChange1}"
                                                       required="{!v.xFields.ResourceType.required}"
                                                       messageWhenValueMissing="This field is mandatory"/>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Resource Type-->
                                
                                <!-- Field: Resource-->
                                <aura:if isTrue="{!v.xFields.Resource.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LookupInput aura:id="resource" label="Resource"
                                                       value="{!v.salesLine.Resource__r}"
                                                       SObjectName="Resource__c"
                                                       columns="[{label: 'Name', fieldName: 'Name', 'class': 'slds-cell-wrap'}, {label: 'Description', fieldName: 'Description__c', 'class': 'slds-cell-wrap'}]"
                                                       queryFields="['Has_Container__c', 'Has_Weight_Volume__c', 'Allow_Manual_Unit_Cost_Adjustment__c']"
                                                       filter="{!'Category__c=\'' + v.salesLine.Category__c + '\' AND Resource_Type__c=\'' + v.salesLine.Resource_Type__c + '\' AND Blocked__c!=TRUE'}"
                                                       pill="{iconName: 'custom:custom6', fieldName: 'Name'}"
                                                       disabled="{!v.xFields.Resource.disabled == true || v.salesLine.Category__c == ''
                                                                 || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval'
                                                                 || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                       onchange="{!c.handleResourceChange}"
                                                       required="{!v.xFields.Resource.required}"
                                                       messageWhenValueMissing="This field is mandatory."/>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Resource-->
                                
                                <!-- Field: Tax Group -->
                                <aura:if isTrue="{!v.salesLine.Category__c == 'Subcontractors'}">
                                    <aura:if isTrue="{!v.xFields.TaxGroup.show}">
                                        <lightning:layoutItem size="6" padding="horizontal-small">
                                            <lightning:combobox aura:id="tax-group" label="Tax Group"
                                                                value="{!v.salesLine.Tax_Group__c}"
                                                                placeholder=""
                                                                options="{!v.taxGroupOptions}"
                                                                onchange="{!c.handleTaxGroupChange}"
                                                                disabled="{!v.xFields.TaxGroup.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                          || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                        </lightning:layoutItem>
                                    </aura:if>
                                </aura:if>
                                <!-- Field: Tax Group -->
                                
                                <!-- Field: Contract Line -->
                                <aura:if isTrue="{!v.xFields.ContractLine.show &amp;&amp; v.salesOrder.Contract__c != null}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Category__c == 'Labor' || v.salesLine.Category__c == 'Equipment' || v.salesLine.Category__c == 'Bundled' }">
                                            <c:LookupInput label="Contract Line" value="{!v.salesLine.Contract_Line__r}" SObjectName="Contract_Line__c" columns="[{label: 'Resource Type', fieldName: 'Resource_Type__r.Name', 'class': 'slds-cell-wrap'}, {label: 'Customer Description', fieldName: 'Customer_Description__c', 'class': 'slds-cell-wrap'}, {label: 'Unit Price', fieldName: 'Unit_Price_Per_UOM__c'}]" queryFields="['Resource_Type__c', 'Resource_Type__r.Name', 'Resource_Type__r.Description__c', 'Resource__c', 'Resource__r.Name', 'Unit_of_Measure__c', 'Unit_of_Measure__r.Name', 'Unit_of_Measure__r.Hours_UOM__c', 'Regular_Rate__c', 'Overtime_Rate__c', 'Premium_Rate__c', 'Customer_Description__c']" filter="{!'Category__c=\'' + v.salesLine.Category__c + '\' AND Contract__c=\'' + v.salesOrder.Contract__c + '\''}" pill="{iconName: 'standard:contract_line_item', expression: '{Name} - {Customer_Description__c}'}" onchange="{!c.handleContractLineChange}" disabled="{!v.salesOrder.Contract__c == null}" dynamicStyle="width:89%"/>
                                            <aura:set attribute="else">
                                                <c:LookupInput label="Contract Line" value="{!v.salesLine.Contract_Line__r}" SObjectName="Contract_Line__c" columns="[{label: 'Resource', fieldName: 'Resource__r.Name', 'class': 'slds-cell-wrap'}, {label: 'Customer Description', fieldName: 'Customer_Description__c', 'class': 'slds-cell-wrap'}, {label: 'Unit Price', fieldName: 'Unit_Price_Per_UOM__c'}]" queryFields="['Resource_Type__c', 'Resource_Type__r.Name', 'Resource__c', 'Resource__r.Name', 'Resource__r.Description__c', 'Unit_of_Measure__c', 'Unit_of_Measure__r.Name', 'Unit_of_Measure__r.Hours_UOM__c', 'Regular_Rate__c', 'Overtime_Rate__c', 'Premium_Rate__c', 'Customer_Description__c', 'Facility__c', 'Facility__r.Name']" filter="{!'Category__c=\'' + v.salesLine.Category__c + '\' AND Contract__c=\'' + v.salesOrder.Contract__c + '\''}" pill="{iconName: 'standard:contract_line_item', expression: '{Name} - {Customer_Description__c}'}" onchange="{!c.handleContractLineChange}" disabled="{!v.salesOrder.Contract__c == null}"  dynamicStyle="width:89%"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Contract Line -->
                                <!--19586-->
                                <!--
                    </lightning:layout>

                    <lightning:layout multipleRows="true">
                    -->
                                <!--19586-->
                                <!--US132832-->
                                <!-- Field: Description -->
                                <aura:if isTrue="{!v.xFields.Description.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input aura:id="description" label="Description"
                                                         value="{!v.salesLine.Description__c}"
                                                         required="{!v.xFields.Description.required}"
                                                         messageWhenValueMissing="This field is mandatory"
                                                         maxlength="100"
                                                         disabled="{!v.xFields.Description.disabled == true || (v.salesLine.Approval_Id__c !=null &amp;&amp; v.salesLine.Contract_Line__c ==null) || v.salesOrder.Document_Status__c == 'Closed'
                                                                   || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <aura:if isTrue="{!v.xFields.Facility.show &amp;&amp; v.salesOrder.Service_Center__r.Advanced_Disposal__c==true}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LookupInputApproval value="{!v.salesLine.Approval_Id__c}"
                                                               label="Profile Approval"
                                                               name="{!v.salesOrder}"
                                                               facility="{!v.salesLine.Facility__c}"
                                                               SObjectName="Sales_Line__c"
                                                               columns="[{label: 'Approval', fieldName: 'Approval'},{label: 'Profile ID', fieldName: 'ProfileID'},{label: 'Bill Unit Code', fieldName: 'UOM'}, {label: 'Description', fieldName: 'Description'},{label: 'Waste Code', fieldName: 'WasteCode'},{label: 'Expiration Date', fieldName: 'ExpirationDate'}]"
                                                               pill="{fieldName: 'Approval'}" hideLookupGlass="true"
                                                               onchange="{!c.handleApprovalChange}"
                                                               />
                                    </lightning:layoutItem>
                                </aura:if>
                                <aura:if isTrue="{!v.salesLine.Category__c == 'Waste Disposal' &amp;&amp; v.salesOrder.Service_Center__r.Advanced_Disposal__c==true}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:select aura:id="category" label="Disposal Billing Method"
                                                          value="{!v.salesLine.Disposal_Billing_Method__c}"
                                                          disabled= "false"
                                                          onchange="{!c.handleDisposalBillingChange}"
                                                          required="{!v.salesLine.Category__c == 'Waste Disposal' &amp;&amp; v.salesOrder.Service_Center__r.Advanced_Disposal__c==true}"
                                                          messageWhenValueMissing="This field is mandatory">
                                            <option value=""></option>
                                            <option value="Direct">Direct</option>
                                            <option value="Indirect">Indirect</option>
                                        </lightning:select>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Description -->
                                
                                <!-- Field: Days Needed -->
                                <aura:if isTrue="{!v.xFields.DaysNeeded.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LightningInput aura:id="days-needed" type="number" label="Days Needed"
                                                          value="{!v.salesLine.Number_of_Day__c}"
                                                          required="{!v.xFields.DaysNeeded.required}"
                                                          messageWhenValueMissing="This field is mandatory."
                                                          min="1"
                                                          messageWhenRangeUnderflow="Days needed must be greater than zero."
                                                          onchange="{!c.handleNumberOfDaysChange}"
                                                          disabled="{!v.xFields.DaysNeeded.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                    || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Days Needed -->
                                
                                <!-- Field: Blank Space  -->
                                <aura:if isTrue="{!v.salesLine.Category__c == 'Subcontractors'}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Blank Space  -->
                                
                                <!-- Field: Quantity -->
                                <aura:if isTrue="{!v.xFields.Quantity.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LightningInput aura:id="quantity"
                                                          type="number" label="Quantity"
                                                          value="{!v.salesLine.Quantity__c}"
                                                          required="{!v.xFields.Quantity.required}"
                                                          messageWhenValueMissing="This field is mandatory."
                                                          min="0.0001" messageWhenRangeUnderflow="Quantity must be greater than zero."
                                                          onchange="{!c.handleQuantityChange}"
                                                          disabled="{!v.xFields.Quantity.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                          step="0.0001"/>
                                        <aura:if isTrue="{!v.salesLine.Category__c == 'Waste Disposal' &amp;&amp; v.salesLine.Min_Sell_Qty__c != null &amp;&amp; v.salesLine.Min_Sell_Qty__c > 0}">
                                            <span style="font-size: x-small">Min. Qty.: {!v.salesLine.Min_Sell_Qty__c}</span>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Quantity -->
                                
                                <!-- Waste001
                        <aura:if isTrue="{!v.xFields.CostMethod.show}">
                            <lightning:layoutItem size="6" padding="horizontal-small">
                                <lightning:combobox aura:id="cost-method" label="Cost Method"
                                                    value="{!v.salesLine.Cost_Method__c}"
                                                    options="{!v.costMethodOptions}"
                                                    placeholder=""
                                                    onchange="{!c.handleCostMethodChange}"
                                                    required="{!v.xFields.CostMethod.required}"
                                                    messageWhenValueMissing="This field is mandatory"
                                                    disabled="{!v.xFields.CostMethod.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                        || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                            </lightning:layoutItem>
                        </aura:if>

                        <aura:if isTrue="{!v.xFields.UnitWeightVolume.show}">
                            <lightning:layoutItem size="6" padding="horizontal-small">
                                <aura:if isTrue="{!v.salesLine.Cost_Method__c == 'Unit_Weight_Vol'}">
                                    <c:LookupInput aura:id="unit-weight-volume" label="Unit Weight/Volume."
                                                   value="{!v.salesLine.Unit_Weight_Vol__r}"
                                                   SObjectName="ResourceUOMAssociation__c"
                                                   columns="[{label: 'Name', fieldName: 'Unit_of_Measure__r.Name'}, {label: 'Description', fieldName: 'Unit_of_Measure__r.Description__c'}]"
                                                   queryFields="['Name', 'Unit_of_Measure__c', 'Container_Size__c']"
                                                   keyFields="['Unit_of_Measure__c']"
                                                   filter="{!'Resource__c=\'' + v.salesLine.Resource__c + '\' AND Unit_of_Measure__r.Weight_Volume__c = true'}"
                                                   pill="{iconName: 'standard:template', fieldName: 'Name'}"
                                                   onchange="{!c.handleUnitWeightVolumeChange1}"
                                                   required="{!v.xFields.UnitWeightVolume.required}"
                                                   messageWhenValueMissing="This field is mandatory."
                                                   disabled="{!v.xFields.UnitWeightVolume.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                        || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                                    <aura:set attribute="else">
                                        <c:LookupInput aura:id="unit-weight-volume" label="Unit Weight/Volume"
                                                       value="{!v.salesLine.Unit_Weight_Vol__r}"
                                                       SObjectName="Unit_of_Measure__c"
                                                       columns="[{label: 'Name', fieldName: 'Name'}, {label: 'Description', fieldName: 'Description__c'}]"
                                                       filter="Weight_Volume__c=TRUE AND Blocked__c!=TRUE"
                                                       pill="{iconName: 'standard:template', fieldName: 'Name'}"
                                                       onchange="{!c.handleUnitWeightVolumeChange2}"
                                                       disabled="{!v.xFields.UnitWeightVolume.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                            || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                                    </aura:set>
                                </aura:if>
                            </lightning:layoutItem>
                        </aura:if>

                        <aura:if isTrue="{!v.xFields.ContainerSize.show}">
                            <lightning:layoutItem size="6" padding="horizontal-small">
                                <aura:if isTrue="{!v.salesLine.Cost_Method__c == 'Container'}">
                                    <c:LookupInput aura:id="container-size" label="Container Size"
                                                   value="{!v.salesLine.Container_Size__r}"
                                                   SObjectName="ResourceUOMAssociation__c"
                                                   columns="[{label: 'Name', fieldName: 'Unit_of_Measure__r.Name'}, {label: 'Description', fieldName: 'Unit_of_Measure__r.Description__c'}]"
                                                   keyFields="['Unit_of_Measure__c']"
                                                   queryFields="['Name']"
                                                   filter="{!'Resource__c=\'' + v.salesLine.Resource__c + '\' AND Unit_of_Measure__r.Container_Size__c=true'}"
                                                   pill="{iconName: 'standard:template', fieldName: 'Name'}"
                                                   required="{!v.xFields.ContainerSize.required}"
                                                   messageWhenValueMissing="This field is mandatory."
                                                   onchange="{!c.handleContainerSizeChange1}"
                                                   disabled="{!v.xFields.ContainerSize.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                        || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                                    <aura:set attribute="else">
                                        <aura:if isTrue="{!v.salesLine.Cost_Method__c == 'Unit_Weight_Vol' &amp;&amp; v.salesLine.Unit_Weight_Vol__c != null &amp;&amp; v.salesLine.Resource_UOM__r.Container_Size__c != null}">
                                            <c:LookupInput aura:id="container-size" label="Container Size"
                                                           value="{!v.salesLine.Container_Size__r}"
                                                           SObjectName="ResourceUOMAssociation__c"
                                                           columns="[{label: 'Name', fieldName: 'Container_Size__r.Name'}, {label: 'Description', fieldName: 'Container_Size__r.Description__c'}]"
                                                           queryFields="['Name', Container_Size__r.Name']"
                                                           keyFields="['Container_Size__c']"
                                                           filter="{!'Resource__c=\'' + v.salesLine.Resource__c + '\' AND Unit_of_Measure__c=\'' + v.salesLine.Unit_Weight_Vol__c + '\''}"
                                                           pill="{iconName: 'standard:template', fieldName: 'Name'}"
                                                           onchange="{!c.handleContainerSizeChange3}"
                                                           disabled="{!v.xFields.ContainerSize.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                                            <aura:set attribute="else">
                                                <c:LookupInput aura:id="container-size" label="Container Size"
                                                               value="{!v.salesLine.Container_Size__r}"
                                                               SObjectName="Unit_of_Measure__c"
                                                               columns="[{label: 'Name', fieldName: 'Name'}, {label: 'Description', fieldName: 'Description__c'}]"
                                                               filter="Container_Size__c=TRUE AND Blocked__c!=TRUE"
                                                               pill="{iconName: 'standard:template', fieldName: 'Name'}"
                                                               onchange="{!c.handleContainerSizeChange2}"
                                                               disabled="{!v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                                            </aura:set>
                                        </aura:if>
                                    </aura:set>
                                </aura:if>
                            </lightning:layoutItem>
                        </aura:if>
                        -->
                                
                                <!-- Field: Min. Sell Qty. -->
                                <aura:if isTrue="{!v.xFields.MinSellQty.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="number" label="Min. Sell Qty."
                                                         value="{!v.salesLine.Min_Sell_Qty__c}"
                                                         step="0.01"
                                                         disabled="{!v.xFields.MinSellQty.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                   || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Min. Sell Qty. -->
                                
                                <!-- Field: UOM Qty. -->
                                <aura:if isTrue="{!v.xFields.UOMQty.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LightningInput aura:id="uom-qty" type="number" label="UOM Qty."
                                                          value="{!v.salesLine.UOM_Qty__c}"
                                                          onchange="{!c.handleUOMQtyChange}"
                                                          required="{!v.xFields.UOMQty.required}"
                                                          messageWhenValueMissing="This field is mandatory."
                                                          min="0.01"
                                                          messageWhenRangeUnderflow="UOM Qty must be greater than zero."
                                                          step="0.01"
                                                          disabled="{!v.xFields.UOMQty.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                    || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: UOM Qty. -->
                            </lightning:layout>
                            
                            <lightning:layout multipleRows="true">
                                <!-- Field: Unit of Measure -->
                                <aura:if isTrue="{!v.xFields.UnitOfMeasure.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Resource_Type__c != null &amp;&amp; v.salesLine.Category__c != 'Subcontractors'}">
                                            <c:LookupInput aura:id="unit-of-measure" label="Unit of Measure" value="{!v.salesLine.Unit_of_Measure__r}"
                                                           SObjectName="Unit_of_Measure__c"
                                                           columns="[{label: 'Name', fieldName: 'Name'}]"
                                                           queryFields="['Hours_UOM__c']"
                                                           filters="{!'[&quot;Blocked__c != TRUE AND Id IN (SELECT Unit_of_Measure__c FROM ResourceTypeUOMAssociation__c WHERE Resource_Type__c =\'' + v.salesLine.Resource_Type__c + '\')&quot;,'
                                                                    + '&quot;Blocked__c != TRUE AND Id IN (SELECT Unit_of_Measure__c FROM Contract_Resource_Type__c WHERE Contract__c=\'' + v.salesOrder.Contract__c + '\' AND Resource_Type__c=\'' + v.salesLine.Resource_Type__c + '\')&quot;]'}"
                                                           pill="{iconName: 'standard:work_type', fieldName: 'Name'}"
                                                           onchange="{!c.handleUnitOfMeasureChange3}"
                                                           required="{!v.xFields.UnitOfMeasure.required}"
                                                           messageWhenValueMissing="This field is mandatory"
                                                           disabled="{!v.xFields.UnitOfMeasure.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                            <aura:set attribute="else">
                                                <aura:if isTrue="{!v.salesLine.Resource__c != null &amp;&amp; v.salesLine.Category__c != 'Subcontractors' &amp;&amp; v.salesLine.Approval_Id__c == null}">
                                                    <c:LookupInput aura:id="unit-of-measure" label="Unit of Measure" value="{!v.salesLine.Unit_of_Measure__r}"
                                                                   SObjectName="Unit_of_Measure__c"
                                                                   columns="[{label: 'Name', fieldName: 'Name'}]"
                                                                   queryFields="['Hours_UOM__c']"
                                                                   filters="{!'[&quot;Blocked__c != TRUE AND Id IN (SELECT Unit_of_Measure__c FROM ResourceUOMAssociation__c WHERE Resource__c =\'' + v.salesLine.Resource__c + '\')&quot;,'
                                                                            + '&quot;Blocked__c != TRUE AND Id IN (SELECT Unit_of_Measure__c FROM Contract_Resource__c WHERE Contract__c=\'' + v.salesOrder.Contract__c + '\' AND Resource__c=\'' + v.salesLine.Resource__c + '\')&quot;]'}"
                                                                   pill="{iconName: 'standard:work_type', fieldName: 'Name'}"
                                                                   onchange="{!c.handleUnitOfMeasureChange3}"
                                                                   required="{!v.xFields.UnitOfMeasure.required}"
                                                                   messageWhenValueMissing="This field is mandatory"
                                                                   disabled="{!v.xFields.UnitOfMeasure.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                                <aura:set attribute="else">
                                                <aura:if isTrue="{!v.salesLine.Category__c != 'Subcontractors' &amp;&amp; v.salesLine.Category__c == 'Waste Disposal'  &amp;&amp; v.salesLine.Approval_Id__c != null}">
                                                  
                                                    <c:LookupInput aura:id="unit-of-measure" label="Unit of Measure" value="{!v.salesLine.Unit_of_Measure__r}"
                                                                   SObjectName="Unit_of_Measure__c"
                                                                   columns="[{label: 'Name', fieldName: 'Name'}]"
                                                                   queryFields="['Hours_UOM__c']"
																   filters="{!'&quot;Blocked__c != TRUE AND Id IN (SELECT Unit_of_Measure__c FROM ResourceUOMAssociation__c WHERE Resource__c =\'' + v.salesLine.Resource__c + '\') AND Name IN (' + v.uomItems + ') &quot;'}"
                                                                   pill="{iconName: 'standard:work_type', fieldName: 'Name'}"
                                                                   onchange="{!c.handleUnitOfMeasureChange3}"
                                                                   required="{!v.xFields.UnitOfMeasure.required}"
                                                                   messageWhenValueMissing="This field is mandatory"
                                                                   disabled="{!v.xFields.UnitOfMeasure.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />                                                  
                                        
                                                    <aura:set attribute="else">
                                                        <aura:if isTrue="{!v.salesLine.Resource__c != null &amp;&amp; v.salesLine.Category__c == 'Subcontractors'}">
                                                            <c:LookupInput aura:id="unit-of-measure" 
                                                                           label="Unit of Measure" 
                                                                           value="{!v.salesLine.Unit_of_Measure__r}" 
                                                                           SObjectName="Unit_of_Measure__c" 
                                                                           columns="[{label: 'Name', fieldName: 'Name'}, {label: 'Description', fieldName: 'Description__c'}, {label: 'Container Size', fieldName: 'Container_Size__c'}]" 
                                                                           queryFields="['Hours_UOM__c']" 
                                                                           filters="{!'&quot;Blocked__c != TRUE AND Id IN (SELECT Unit_of_Measure__c FROM ResourceUOMAssociation__c WHERE Resource__c = \'' + v.costPlusMESResourceId + '\')&quot;'}" 
                                                                           pill="{iconName: 'standard:work_type', fieldName: 'Name'}" 
                                                                           onchange="{!c.handleUnitOfMeasureChange3}" 
                                                                           required="{!v.xFields.UnitOfMeasure.required}" 
                                                                           messageWhenValueMissing="This field is mandatory" 
                                                                           disabled="{!v.xFields.UnitOfMeasure.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval'}"/>
                                                            <aura:set attribute="else">
                                                                <c:LookupInput aura:id="unit-of-measure" label="Unit of Measure" value="{!v.salesLine.Unit_of_Measure__r}" SObjectName="Unit_of_Measure__c" columns="[{label: 'Name', fieldName: 'Name'}, {label: 'Description', fieldName: 'Description__c'}, {label: 'Container Size', fieldName: 'Container_Size__c'}]" queryFields="['Hours_UOM__c']" filter="Blocked__c!=TRUE" pill="{iconName: 'standard:work_type', fieldName: 'Name'}" onchange="{!c.handleUnitOfMeasureChange3}" required="{!v.xFields.UnitOfMeasure.required}" messageWhenValueMissing="This field is mandatory" disabled="{!v.xFields.UnitOfMeasure.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval'}"/>
                                                            </aura:set>
                                                        </aura:if>
                                                    </aura:set>
                                                </aura:if>
                                              </aura:set>
                                            </aura:if>
                                          </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Unit of Measure -->
                                
                                <!-- Field: Unit Price -->
                                <!--
                            Ticket#22007 allow Unit Price editing even the contract is linked, set contract line to null if unit price changed.
                                - || v.salesLine.Contract_Line__c != null
                        -->
                                <aura:if isTrue="{!v.xFields.UnitPrice.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true &amp;&amp; v.salesLine.Non_Billable__c != true}">
                                            <c:LightningInput type="number" aura:id="unit-price"
                                                              label="{!if(v.salesLine.Category__c == 'Bundled', 'Bundled Price', 'Unit Price')}"
                                                              value="{!v.salesLine.Unit_Price__c}"
                                                              formatter="currency"
                                                              onchange="{!c.handleUnitPriceChange}"
                                                              required="{!v.xFields.UnitPrice.required}"
                                                              messageWhenValueMissing="This field is mandatory"
                                                              min="{!if(v.salesLine.Category__c == 'Waste Disposal', 0.01, 0)}"
                                                              messageWhenRangeUnderflow="Quantity must be greater than zero."
                                                              disabled="{!v.xFields.UnitPrice.disabled == true || 
                                                                        v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true 
                                                                        || v.salesLine.Disposal_Billing_Method__c == 'Direct' || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                              step="0.001"/>
                                            <aura:set attribute="else">
                                                <c:LightningInput type="number" aura:id="unit-price"
                                                                  label="{!if(v.salesLine.Category__c == 'Bundled', 'Bundled Price', 'Unit Price')}"
                                                                  value="{!v.salesLine.xUnit_Price__c}"
                                                                  formatter="currency"
                                                                  onchange="{!c.handlexUnitPriceChange}"
                                                                  required="{!v.xFields.UnitPrice.required}"
                                                                  messageWhenValueMissing="This field is mandatory"
                                                                  min="{!if(v.salesLine.Category__c == 'Waste Disposal', 0.01, 0)}"
                                                                  messageWhenRangeUnderflow="Quantity must be greater than zero."
                                                                  disabled="{!v.xFields.UnitPrice.disabled == true || v.salesLine.Disposal_Billing_Method__c == 'Direct' || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                                  step="0.001"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Unit Price -->
                                
                                <!-- Field: Unit Cost -->
                                <!-- //Ticket#19964 -->
                                <aura:if isTrue="{!v.xFields.UnitCost.show &amp;&amp; (v.salesLine.Category__c == 'Waste Disposal' || v.salesLine.Category__c == 'Subcontractors')}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true}">
                                            <c:LightningInput aura:id="unit-cost" type="number" label="Unit Cost"
                                                              value="{!v.salesLine.Unit_Cost__c}"
                                                              required="{!v.xFields.UnitCost.required}"
                                                              messageWhenValueMissing="This field is mandatory."
                                                              min="0.0001"
                                                              messageWhenRangeUnderflow="Quantity must be greater than zero."
                                                              onchange="{!c.handleUnitCostChange}"
                                                              step="0.0001"
                                                              disabled="{!(v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null) || v.xFields.UnitCost.disabled == true}"/>
                                            <aura:set attribute="else">
                                                <c:LightningInput aura:id="unit-cost" type="number"
                                                                  label="Unit Cost"
                                                                  value="{!v.salesLine.xUnit_Cost__c}"
                                                                  required="{!v.xFields.UnitCost.required}"
                                                                  messageWhenValueMissing="This field is mandatory."
                                                                  min="0.0001"
                                                                  messageWhenRangeUnderflow="Quantity must be greater than zero."
                                                                  onchange="{!c.handleUnitCostChange}"
                                                                  step="0.0001"
                                                                  disabled="{!(v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- //Ticket#19964 -->
                                <!-- Field: Unit Cost -->
                            </lightning:layout>
                            
                            <lightning:layout multipleRows="true">
                                <!-- Field: Bundled -->
                                <aura:if isTrue="{!v.xFields.BillAsLumpSum.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="checkbox" label="Bundled" variant="label-stacked"
                                                         checked="{!v.salesLine.Bill_as_Lump_Sum__c}"
                                                         onchange="{!c.handleBillAsLumpSumChange}"
                                                         disabled="{!v.xFields.BillAsLumpSum.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                   || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Bundled -->
                                
                                <!-- Field: Non-Billable -->
                                <aura:if isTrue="{!v.xFields.NonBillable.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="checkbox" label="Non-Billable" variant="label-stacked"
                                                         checked="{!v.salesLine.Non_Billable__c}"
                                                         onchange="{!c.handleNonBillableChange}"
                                                         disabled="{!v.xFields.NonBillable.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                   || v.salesOrder.Approval_Status__c == 'Pending_Approval'
                                                                   || (v.salesLine.T_M_Lines1__r &amp;&amp; v.salesLine.T_M_Lines1__r.records.length > 0)
                                                                   || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Non-Billable -->
                                
                                <!-- Field: Tax Group -->
                                <aura:if isTrue="{!v.xFields.TaxGroup.show &amp;&amp; v.salesLine.Category__c != 'Subcontractors'}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:combobox aura:id="tax-group" label="Tax Group"
                                                            value="{!v.salesLine.Tax_Group__c}"
                                                            placeholder=""
                                                            options="{!v.taxGroupOptions}"
                                                            onchange="{!c.handleTaxGroupChange}"
                                                            disabled="{!v.xFields.TaxGroup.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                      || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Tax Group -->
                                
                                <!-- Field: Markup Option -->
                                <aura:if isTrue="{!v.xFields.MarkupOption.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:combobox label="Markup Option"
                                                            value="{!v.salesLine.Markup_Option__c}"
                                                            options="{!v.markupOptions}"
                                                            placeholder=""
                                                            onchange="{!c.handleMarkupOptionChange}"
                                                            disabled="{!v.xFields.MarkupOption.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                      || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Markup Option -->
                                
                                <!-- Field: Blank Space  -->
                                <aura:if isTrue="{!v.salesLine.Category__c == 'Subcontractors'}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Blank Space  -->
                                
                                <!-- Field: Markup -->
                                <aura:if isTrue="{!v.xFields.Markup.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="number" label="Markup"
                                                         value="{!v.salesLine.Markup__c}"
                                                         oncommit="{!c.handleMarkupChange}"
                                                         step="0.01"
                                                         disabled="{!v.xFields.Markup.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                   || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                <!-- Field: Markup -->
                                
                                <aura:if isTrue="{!v.xFields.BundlePricingMethod.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:select aura:id="bundle-pricing-method" label="Bundle Pricing Method"
                                                          value="{!v.salesLine.Bundle_Pricing_Method__c}"
                                                          required="{!v.xFields.BundlePricingMethod.required}"
                                                          onchange="{!c.handleBundlePricingMethodChange}"
                                                          messageWhenValueMissing="This field is mandatory"
                                                          disabled="{!v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}">
                                            <option label="" value=""/>
                                            <option label="Bundled Per Unit Amount" value="Per Unit"/>
                                            <option label="Bundled Per Total Amount" value="Per Total"/>
                                        </lightning:select>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="number" aura:id="profit-margin" label="Profit Margin" value="{!if(v.salesLine.Line_Amount__c &amp;&amp; v.salesLine.Line_Amount__c != 0, 1 - v.salesLine.Line_Cost__c / v.salesLine.Line_Amount__c, 0)}" formatter="percent" disabled="true" step="0.0001"/>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                <!--ticket 19130-->
                                <!--
                        <aura:if isTrue="{!v.xFields.ParentLine.show}">
                            <lightning:layoutItem size="6" padding="horizontal-small">
                                <lightning:select label="Parent Line" value="{!v.selectedParentLineNo}" onchange="{!c.handleParentLineChange}" disabled="{!v.xFields.ParentLine.disabled == true || v.salesOrder.Document_Status__c == 'Closed' || v.salesOrder.Approval_Status__c == 'Pending_Approval'}">
                                    <option value="" label=""/>
                                    <aura:iteration items="{!v.parentLineOptions}" var="parentLineOption">
                                        <option value="{!parentLineOption.value}" label="{!parentLineOption.label}" selected="{!v.selectedParentLineNo == parentLineOption.Line_No__c}"/>
                                    </aura:iteration>
                                </lightning:select>
                            </lightning:layoutItem>
                        </aura:if>
                        -->
                                <!--ticket 19130-->
                            </lightning:layout>
                        </lightning:layoutItem>
                        
                        <!--right panel-->
                        <lightning:layoutItem size="5" padding="around-small">
                            <!--
                    <lightning:layout>
                        <lightning:layoutItem size="12" padding="horizontal-small">
                            <aura:if isTrue="{!v.salesLine.Category__c != null}">
                                <lightning:select aura:id="sales-order-job-task" label="Job Task" value="{!v.salesLine.Sales_Order_Job_Task__r.Line_No__c}" onchange="{!c.handleJobTaskChange}" required="true" disabled="{!true || v.salesLine.Bundle_Line__r != null}">
                                    <aura:iteration items="{!v.jobTasks}" var="jobTask">
                                        <option value="{!jobTask.Line_No__c}">{!jobTask.Name}</option>
                                    </aura:iteration>
                                </lightning:select>
                            </aura:if>
                        </lightning:layoutItem>
                    </lightning:layout>
                    -->
                            <lightning:layout multipleRows="true">
                                <!--
                        <aura:if isTrue="{!v.xFields.LaborUnitPrice.show}">
                            <lightning:layoutItem size="6" padding="horizontal-small">
                                <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c == true}">
                                    <lightning:input type="number" label="Labor Unit Price" value="{!v.salesLine.xUnit_Price__c}" formatter="currency" disabled="{!v.xFields.LaborUnitPrice.disabled}"/>
                                    <aura:set attribute="else">
                                        <lightning:input type="number" label="Labor Unit Price" value="{!v.salesLine.Unit_Price__c}" formatter="currency" disabled="{!v.xFields.LaborUnitPrice.disabled}"/>
                                    </aura:set>
                                </aura:if>
                            </lightning:layoutItem>
                        </aura:if>
                        -->
                                
                                <aura:if isTrue="{!v.xFields.TotalLaborHours.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="number" label="Total Labor Hours" value="{!(v.salesLine.Regular_Hours__c + v.salesLine.Overtime_Hours__c + v.salesLine.Premium_Hours__c) * v.salesLine.Quantity__c}" step="0.01" disabled="{!v.xFields.TotalLaborHours.disabled  || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" />
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                <aura:if isTrue="{!v.xFields.PricingSource.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input label="Pricing Source" value="{!v.salesLine.Pricing_Source_2__c}" disabled="{!v.xFields.PricingSource.disabled == true || v.xFields.PricingSource.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"/>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                <!--
                        <aura:if isTrue="{!v.salesOrder.Contract__c != null}">
                            <aura:if isTrue="{!v.xFields.ContractLine}">
                                <aura:if isTrue="{!v.xFields.ContractLine.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LookupInput label="Contract Line" value="{!v.salesLine.Contract_Line__r}" SObjectName="Contract_Line__c" columns="[{label: 'Name', fieldName: 'Name'}, {label: 'Resource Type', fieldName: 'Resource_Type__r.Name'}, {label: 'Resource', fieldName: 'Resource__r.Name'}]" queryFields="['Regular_Rate__c', 'Overtime_Rate__c', 'Premium_Rate__c', 'Customer_Description__c']" filter="{!'Resource_Type__c=\'' + v.salesLine.Resource_Type__c + '\' AND Contract__c=\'' + v.salesOrder.Contract__c + '\' AND Contract__c != null'}" pill="{iconName: 'standard:contract_line_item', fieldName: 'Name'}" onchange="{!c.handleContractLineChange}" disabled="{!v.xFields.ContractLine.disabled}"/>
                                    </lightning:layoutItem>
                                </aura:if>
                            </aura:if>
                        </aura:if>
                        -->
                                
                                
                                <aura:if isTrue="{!v.xFields.RegularRate.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <!--
        <lightning:input type="number" label="Regular Rate" value="{!v.salesLine.Regular_Rate__c}" formatter="currency" disabled="{!v.salesLine.Contract_Line__c != null}" step="0.01"/>
        -->
                                        <!--
                                <lightning:input type="number" label="Regular Rate" value="{!v.salesLine.Regular_Rate__c}" formatter="currency" disabled="{!v.xFields.RegularRate.disabled}" step="0.01"/>
                                -->
                                        <c:LightningInput type="number" label="Regular Rate"
                                                          value="{!v.salesLine.Regular_Rate__c}"
                                                          formatter="currency"
                                                          onchange="{!c.handleRegularRateChange}"
                                                          disabled="{!v.xFields.RegularRate.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                    || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                          step="0.01"/>
                                    </lightning:layoutItem>
                                    
                                    <!-- Ticket#22710 -->
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <c:LightningInput type="number" label="Regular Unit Cost"
                                                          value="{!v.salesLine.Regular_Unit_Cost__c}"
                                                          formatter="currency"
                                                          disabled="true"
                                                          step="0.01"/>
                                    </lightning:layoutItem>
                                    <!-- Ticket#22710 -->
                                </aura:if>
                                <!--rate.fix-->
                                <aura:if isTrue="{!v.salesLine.Unit_of_Measure__r.Hours_UOM__c == true}">
                                    <!--rate.fix-->
                                    <aura:if isTrue="{!v.xFields.OvertimeRate.show}">
                                        <lightning:layoutItem size="6" padding="horizontal-small">
                                            <!--
                                    <lightning:input type="number" label="Overtime Rate" value="{!v.salesLine.Overtime_Rate__c}" formatter="currency" disabled="{!v.salesLine.Contract_Line__c != null}" step="0.01"/>
                                    -->
                                            <!--
                                    <lightning:input type="number" label="Overtime Rate" value="{!v.salesLine.Overtime_Rate__c}" formatter="currency" disabled="{!v.xFields.OvertimeRate.disabled}" step="0.01"/>
                                    -->
                                            <c:LightningInput type="number" label="Overtime Rate"
                                                              value="{!v.salesLine.Overtime_Rate__c}"
                                                              formatter="currency"
                                                              onchange="{!c.handleOvertimeRateChange}"
                                                              disabled="{!v.xFields.OvertimeRate.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                        || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                              step="0.01"/>
                                        </lightning:layoutItem>
                                        <!-- Ticket#22710 -->
                                        <lightning:layoutItem size="6" padding="horizontal-small">
                                            <c:LightningInput type="number" label="Overtime Unit Cost"
                                                              value="{!v.salesLine.Overtime_Unit_Cost__c}"
                                                              formatter="currency"
                                                              disabled="true"
                                                              step="0.01"/>
                                        </lightning:layoutItem>
                                        <!-- Ticket#22710 -->
                                    </aura:if>
                                    
                                    <aura:if isTrue="{!v.xFields.DoubleTimeRate.show}">
                                        <lightning:layoutItem size="6" padding="horizontal-small">
                                            <!--
                                    <lightning:input type="number" label="Double Time Rate" value="{!v.salesLine.Premium_Rate__c}" formatter="currency" disabled="{!v.salesLine.Contract_Line__c != null}" step="0.01"/>
                                    -->
                                            <!--
                                    <lightning:input type="number" label="Double Time Rate" value="{!v.salesLine.Premium_Rate__c}" formatter="currency" onchange="{!c.handleDoubleTimeRateChange}" disabled="{!v.xFields.DoubleTimeRate.disabled}" step="0.01"/>
                                    -->
                                            <c:LightningInput type="number" label="Double Time Rate"
                                                              value="{!v.salesLine.Premium_Rate__c}"
                                                              formatter="currency"
                                                              onchange="{!c.handleDoubleTimeRateChange}"
                                                              disabled="{!v.xFields.DoubleTimeRate.disabled == true || v.salesOrder.Document_Status__c == 'Closed'
                                                                        || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                              step="0.01"/>
                                        </lightning:layoutItem>
                                        <!-- Ticket#22710 -->
                                        <lightning:layoutItem size="6" padding="horizontal-small">
                                            <c:LightningInput type="number" label="Double Time Unit Cost"
                                                              value="{!v.salesLine.Double_Time_Unit_Cost__c}"
                                                              formatter="currency"
                                                              disabled="true"
                                                              step="0.01"/>
                                        </lightning:layoutItem>
                                        <!-- Ticket#22710 -->
                                    </aura:if>
                                    <!--rate.fix-->
                                </aura:if>
                                <!--rate.fix-->
                                
                                <aura:if isTrue="{!v.xFields.Tax.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <!--ticket 19535-->
                                        <!--<aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true &amp;&amp; v.salesLine.Non_Billable__c != true}">-->
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true}">
                                            <!--ticket 19535-->
                                            <lightning:input type="number" label="Tax" value="{!v.salesLine.Tax__c}" formatter="currency" disabled="{!v.xFields.Tax.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            <aura:set attribute="else">
                                                <lightning:input type="number" label="Tax" value="{!v.salesLine.xLine_Amount__c * v.salesLine.Tax_Pct__c / 100.00}" formatter="currency" disabled="{!v.xFields.Tax.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                            </lightning:layout>
                            
                            <lightning:layout multipleRows="true">
                                <aura:if isTrue="{!v.xFields.LineAmount.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true}">
                                            <lightning:input type="number" label="Line Amount" value="{!v.salesLine.Line_Amount__c}" formatter="currency" disabled="{!v.xFields.LineAmount.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            <aura:set attribute="else">
                                                <lightning:input type="number" label="Line Amount" value="{!v.salesLine.xLine_Amount__c}" formatter="currency" disabled="{!v.xFields.LineAmount.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                
                                <aura:if isTrue="{!v.xFields.UnitCost.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true}">
                                            <!--
                                    <lightning:input type="number" label="Unit Cost" value="{!v.salesLine.Unit_Cost__c}" formatter="currency" onchange="{!c.handleUnitCostChange}" disabled="{!v.xFields.UnitCost.disabled}" step="0.01"/>
                                    -->
                                            <c:LightningInput aura:id="unit-cost" type="number" label="Unit Cost"
                                                              value="{!v.salesLine.Unit_Cost__c}"
                                                              required="{!v.xFields.UnitCost.required}"
                                                              messageWhenValueMissing="This field is mandatory."
                                                              min="0.0001"
                                                              messageWhenRangeUnderflow="Unit Cost must be greater than zero."
                                                              onchange="{!c.handleUnitCostChange}"
                                                              disabled="{!v.xFields.UnitCost.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                              step="0.0001"/>
                                            <aura:set attribute="else">
                                                <!--
                                        <lightning:input type="number" label="Unit Cost" value="{!v.salesLine.xUnit_Cost__c}" formatter="currency" onchange="{!c.handleUnitCostChange}" disabled="{!v.xFields.UnitCost.disabled}" step="0.01"/>
                                        -->
                                                <c:LightningInput aura:id="unit-cost" type="number" label="Unit Cost"
                                                                  value="{!v.salesLine.xUnit_Cost__c}"
                                                                  required="{!v.xFields.UnitCost.required}"
                                                                  messageWhenValueMissing="This field is mandatory."
                                                                  min="0.0001"
                                                                  messageWhenRangeUnderflow="Unit Cost must be greater than zero."
                                                                  onchange="{!c.handleUnitCostChange}"
                                                                  disabled="{!v.xFields.UnitCost.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}"
                                                                  step="0.0001"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                <aura:if isTrue="{!v.xFields.LineAmountIncludingTax.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true}">
                                            <lightning:input type="number" label="Line Amount Incl. Tax" value="{!v.salesLine.Line_Amt_Incl_Tax__c}" formatter="currency" disabled="{!v.xFields.LineAmountIncludingTax.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            <aura:set attribute="else">
                                                <lightning:input type="number" label="Line Amount Incl. Tax" value="{!v.salesLine.xLine_Amount__c + v.salesLine.xLine_Amount__c * v.salesLine.Tax_Pct__c / 100}" formatter="currency" disabled="{!v.xFields.LineAmountIncludingTax.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                
                                <aura:if isTrue="{!v.xFields.LineCost.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <aura:if isTrue="{!v.salesLine.Bill_as_Lump_Sum__c != true}">
                                            <lightning:input type="number" label="Line Cost" value="{!v.salesLine.Line_Cost__c}" formatter="currency" disabled="{!v.xFields.LineCost.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            <aura:set attribute="else">
                                                <lightning:input type="number" label="Line Cost" value="{!v.salesLine.xLine_Cost__c}" formatter="currency" disabled="{!v.xFields.LineCost.disabled || (v.salesOrder.Allow_Edit__c != true &amp;&amp; v.salesOrder.Id != null)}" step="0.01"/>
                                            </aura:set>
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                <aura:if isTrue="{!v.xFields.RolledUpUnitPrice.show}">
                                    <lightning:layoutItem size="6" padding="horizontal-small">
                                        <lightning:input type="number" label="Rolled-Up Bundled Line Amount(s)" value="{!v.salesLine.Rolled_up_Unit_Price__c}" formatter="currency" disabled="true" step="0.01"/>
                                    </lightning:layoutItem>
                                </aura:if>
                                
                                <!--
                        <lightning:layoutItem size="6" padding="horizontal-small">
                            <lightning:input type="number" label="Regular Hours" value="{!v.salesLine.Regular_Hours__c}" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem size="6" padding="horizontal-small">
                            <lightning:input type="number" label="Overtime Hours" value="{!v.salesLine.Overtime_Hours__c}" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem size="6" padding="horizontal-small">
                            <lightning:input type="number" label="Double Time Hours" value="{!v.salesLine.Premium_Hours__c}" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        -->
                                
                                <!--
                        <lightning:layoutItem size="12" padding="horizontal-small">
                            <lightning:input type="number" label="Unit Price" value="{!v.salesLine.Unit_Price__c}" formatter="currency" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem size="12" padding="horizontal-small">
                            <lightning:input type="number" label="xUnit Price" value="{!v.salesLine.xUnit_Price__c}" formatter="currency" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem size="12" padding="horizontal-small">
                            <lightning:input type="number" label="xUnit Cost" value="{!v.salesLine.xUnit_Cost__c}" formatter="currency" disabled="true" step="0.01"/>
                        </lightning:layoutItem>

                        <lightning:layoutItem size="12" padding="horizontal-small">
                            <lightning:input type="number" label="xLine_Amount__c" value="{!v.salesLine.xLine_Amount__c}" formatter="currency" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        <lightning:layoutItem size="12" padding="horizontal-small">
                            <lightning:input type="number" label="xLine_Cost__c" value="{!v.salesLine.xLine_Cost__c}" formatter="currency" disabled="true" step="0.01"/>
                        </lightning:layoutItem>
                        -->
                            </lightning:layout>
                        </lightning:layoutItem>
                        
                        <!--bottom panel-->
                        <lightning:layoutItem size="12" padding="around-small">
                            <lightning:card>
                                <p class="slds-p-horizontal_small">
                                    <!--equipment schedule lines-->
                                    <!--<aura:if isTrue="{!v.salesLine.Category__c == 'Labor'}">-->
                                    <aura:if isTrue="{!v.salesLine.Category__c == 'Labor' || v.salesLine.Category__c == 'Equipment'}">
                                        <!--equipment schedule lines-->
                                        <c:SalesLineDetailList salesOrder="{!v.salesOrder}" salesLine="{!v.salesLine}"/>
                                    </aura:if>
                                    <aura:if isTrue="{!v.salesLine.Category__c == 'Bundled' &amp;&amp; v.salesLine.Resource_Type__c != null}">
                                        <!--job task-->
                                        <!--
                                <c:BundledSalesLines salesOrder="{!v.salesOrder}" salesLines="{!v.salesLines}" parentSalesLine="{!v.salesLine}"/>
                                -->
                                        <!--contract specific resource-->
                                        <!--
                                <c:BundledSalesLines salesOrder="{!v.salesOrder}" jobTaskWrapper="{!v.jobTaskWrapper}" userInfoWrapper="{!v.userInfoWrapper}" lumpSumLine="{!v.salesLine}"/>
                                -->
                                        <c:BundledSalesLines salesOrder="{!v.salesOrder}" jobTaskWrapper="{!v.jobTaskWrapper}" setupData="{!v.setupData}" lumpSumLine="{!v.salesLine}"/>
                                        <!--contract specific resource-->
                                        <!--job task-->
                                    </aura:if>
                                </p>
                            </lightning:card>
                        </lightning:layoutItem>
                    </lightning:layout>
                    <!--ticket 19130-->
                    <!--</p>-->
                    <!--ticket 19130-->
                </lightning:card>
                
                <!--ticket 19130-->
            </lightning:layoutItem>
            <!--ticket 77758-->
            <aura:if isTrue="{!v.salesLine.Sales_Child_Lines__r &amp;&amp; v.salesLine.Sales_Child_Lines__r.records}">
                <lightning:layoutItem size="3" flexibility="auto, no-grow">
                    <lightning:card>
                        <lightning:layout multipleRows="true">
                            <lightning:layoutItem size="12" padding="horizontal-small" class="slds-p-bottom--x-small">
                                <p class="slds-text-heading_small slds-truncate" Style="font-weight: bold;padding-bottom: 8px;" >Child Resource Types/Resources</p>
                                
                                <lightning:button label="Add Child Resource" variant="brand"
                                                  onclick="{!c.addChildResource}"
                                                  disabled="{!v.xFields.ChildResource.disabled || v.salesOrder.Document_Status__c == 'Closed'
                                                            || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                            </lightning:layoutItem>
                            <aura:if isTrue="{!v.salesLine.Sales_Child_Lines__r}">
                                <aura:iteration items="{!v.salesLine.Sales_Child_Lines__r.records}" var="relation" indexVar="rowIndex">
                                    <lightning:layoutItem flexibility="auto, no-grow" padding="around-small" class="slds-p-bottom--x-small">
                                        <lightning:select variant="label-hidden" class="label-hidden" label="{!rowIndex}"
                                                          value="{!relation.Child_Line__r.Line_No__c}"
                                                          onchange="{!c.handleRelationChange}"
                                                          disabled="{!v.xFields.ChildResource.disabled || v.salesOrder.Document_Status__c == 'Closed'
                                                                    || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}">
                                            <option value="" label=""/>
                                            <aura:iteration items="{!v.jobTaskWrapper.SalesLines}" var="salesLine">
                                                <aura:if isTrue="{!(!salesLine.Sales_Child_Lines__r || (salesLine.Sales_Child_Lines__r &amp;&amp; salesLine.Sales_Child_Lines__r.records))
                                                                 &amp;&amp; salesLine.Line_No__c != v.salesLine.Line_No__c &amp;&amp; salesLine.System_Calculated_Line__c != true &amp;&amp; salesLine.Category__c != 'Bundled'}">
                                                    <option value="{!salesLine.Line_No__c}" label="{!'Line #' + salesLine.Line_No__c + ' - ' + salesLine.Description__c}"/>
                                                </aura:if>
                                            </aura:iteration>
                                        </lightning:select>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem flexibility="auto, no-grow" class="slds-p-top--small slds-p-bottom--small slds-p-right--small">
                                        <lightning:buttonIcon value="{!rowIndex}" iconName="utility:delete"
                                                              onclick="{!c.removeParentChildRelation}"
                                                              disabled="{!v.xFields.ChildResource.disabled || v.salesOrder.Document_Status__c == 'Closed'
                                                                        || v.salesOrder.Approval_Status__c == 'Pending_Approval' || v.salesOrder.Expired__c == true}" />
                                    </lightning:layoutItem>
                                </aura:iteration >
                            </aura:if>
                        </lightning:layout>
                    </lightning:card>
                </lightning:layoutItem>
            </aura:if>
            <!--ticket 77758-->
        </lightning:layout>
    </p>
    <!--ticket 19130-->
</aura:component>