<apex:page language="{!$CurrentPage.parameters.lang}" standardController="Sales_Order__c"
           extensions="SalesOrderController2" id="thePage"
           sidebar="false">
<!--
    <apex:stylesheet value="{!URLFOR($Resource.GoldFinch, '/css/style.css')}"/>
    <apex:stylesheet value="https://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js">
    </script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js">
    </script>
    <script src="{!URLFOR($Resource.Typeahead, '/typeahead.bundle.min.js')}"></script>
    <head>
        <style>

            .tmLineWrap input[type="text"], .slds-scope input[type="text"] {
                max-width: 100px;
            }

            body td.actionColumn:before, .slds-scope td.actionColumn:before {
                display: none;
            }

            body .list .actionColumn, .slds-scope .list .actionColumn {
                padding-left: 0px;
            }

            .tmLineWrap {
                overflow: scroll;
            }

            .brdrTable {
                border-color: #ccc;
                border: 1px solid #ccc;
                border-collapse: collapse;
            }

            .brdrTable td {
                white-space: nowrap;
            }

            .bPageBlock th.vfLabelColTextWrap {
                white-space: nowrap;
            }

            .bPageBlock .detailList tr td {
                white-space: nowrap;
            }
        </style>
    </head>
    <script>
        $ = jQuery.noConflict();

        $(document).ready(function () {
            $(document.getElementById("{!$Component.theForm.thePageBlock.theSection.theSILTable}")).find("tbody").sortable().on("sortstart", function (event, ui) {
            }).on("sortstop", function (event, ui) {
            }).on("sortchange", function (event, ui) {
            }).on("sortupdate", function (event, ui) {
                var elements = $(document.getElementById("{!$Component.theForm.thePageBlock.theSection.theSILTable}")).find("tbody").find('tr').find('td').find('input');
                var j = 0;
                for (var i = 0; i < elements.length; i++) {
                    if (elements[i].id.indexOf(":theLineNo") > 0) {
                        j++;
                        elements[i].value = j * 10;
                    }
                }
            });
            $("input").keypress(function (event) {
                if (event.keyCode == 13) {
                    return false;
                }
            });
        });

        $(document).ready(function () {
            //$(".tmLineWrap").css("max-width", (screen.width-100));
        });

        function setFocusOnLoad() {
        }

        function confirmDelete(a) {
            a || (a = LC.getLabel("Global", "are_you_sure"));
            return Modal.confirm(a);
        }

        function confirmCopyTime(lineType) {
            var result = confirm("Are you sure to copy times to other T&M " + lineType + " lines?");
            if (!result) {
                return false;
            }

            return true;
        }

        var focuselmnt;

        function validateFieldInList(fieldThatChanged) {
            var elemenetIdForField = fieldThatChanged.id;
            focuselmnt = elemenetIdForField.replace('theItem', 'theQuantity');
            var lastColonPosition = elemenetIdForField.lastIndexOf(':');
            var secondToLastColonPosition = elemenetIdForField.lastIndexOf(':', lastColonPosition - 1);
            //alert (elemenetIdForField +"/" + lastColonPosition + "/" + secondToLastColonPosition);
            var fieldName = (elemenetIdForField.substr(lastColonPosition + 1));
            var lineNo = (elemenetIdForField.substr(secondToLastColonPosition + 1, (lastColonPosition - secondToLastColonPosition) - 1));
            //AES-388 add theMiscResource
            if (fieldName == 'theJobPosition' || fieldName == 'theServiceCenter' || fieldName == 'theEServiceCenter' || fieldName == 'theUOM' || fieldName == 'theMResource' ||
                fieldName == 'theLResource' || fieldName == 'theEResource' || fieldName == 'theSResource' || fieldName == 'theFResource' || fieldName == 'theWResource' ||
                fieldName == 'theDResource' || fieldName == 'theLUOM' || fieldName == 'theMUOM' || fieldName == 'theEUOM' || fieldName == 'theSUOM'
                || fieldName == 'theFUOM' || fieldName == 'theWUOM' || fieldName == 'theDUOM' || fieldName == 'theLumpUOM' || fieldName == 'theMiscUOM' ||
                fieldName == 'theEquipment' || fieldName == 'theLContractLine' || fieldName == 'theEContractLine' || fieldName == 'theMContractLine' ||
                fieldName == 'theLumpSumResourceType' || fieldName == 'theLumpSumContractLine' || fieldName == 'theTaxArea' || fieldName == 'theMiscResource' || fieldName == 'theLTM') {
                var newFieldValue = document.getElementById(elemenetIdForField + "_lkid").value;
            } else if (fieldName == 'theUsePremiumRate' || fieldName == 'theBillSiteTime' || fieldName == 'theLBillasLumpSum' || fieldName == 'theEBillasLumpSum' ||
                fieldName == 'theMBillasLumpSum' || fieldName == 'theSBillasLumpSum' || fieldName == 'theDBillasLumpSum' || fieldName == 'theMiscBillasLumpSum' ||
                fieldName == 'theWBillasLumpSum' || fieldName == 'theLNonBillable' || fieldName == 'theENonBillable' || fieldName == 'theMNonBillable' ||
                fieldName == 'theSNonBillable' || fieldName == 'theDNonBillable' || fieldName == 'theMiscNonBillable' || fieldName == 'theWNonBillable' || fieldName == 'theEToInvoice' ||
                fieldName == 'theLToInvoice' || fieldName == 'theMToInvoice' || fieldName == 'theSToInvoice' || fieldName == 'theWToInvoice' || fieldName == 'theDToInvoice' || fieldName == 'theLumpToInvoice') {
                //Ticket#13673
                var newFieldValue = document.getElementById(elemenetIdForField).checked;
            } else {
                var newFieldValue = document.getElementById(elemenetIdForField).value;
            }
            //alert (fieldName +"/" + newFieldValue + "/" + lineNo);
            setFocusElement(fieldName, elemenetIdForField);
            if (fieldName == 'theTaxArea') {
                lineNo = -1;
                validateTaxArea(fieldName, newFieldValue, lineNo);
            } else {
                validateField(fieldName, newFieldValue, lineNo);
            }
        }

        function setFocusElement(fieldName, elemenetIdForField) {
            switch (fieldName) {
                case "theLBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theLBillasLumpSum', 'theLNonBillable');
                    break;
                case "theLNonBillable":
                    focuselmnt = elemenetIdForField.replace('theLNonBillable', 'theJobPosition');
                    break;
                case "theJobPosition":
                    focuselmnt = elemenetIdForField.replace('theJobPosition', 'theLResource');
                    break;
                case "theLResource":
                    focuselmnt = elemenetIdForField.replace('theLResource', 'theDescription');
                    break;
                case "theDescription":
                    focuselmnt = elemenetIdForField.replace('theDescription', 'theJobStartTime');
                    break;
                case "theJobStartTime":
                    focuselmnt = elemenetIdForField.replace('theJobStartTime', 'theSiteStartTime');
                    break;
                case "theSiteStartTime":
                    focuselmnt = elemenetIdForField.replace('theSiteStartTime', 'theSiteEndTime');
                    break;
                case "theSiteEndTime":
                    focuselmnt = elemenetIdForField.replace('theSiteEndTime', 'theJobEndTime');
                    break;
                case "theJobEndTime":
                    focuselmnt = elemenetIdForField.replace('theJobEndTime', 'theLunchStartTime');
                    break;
                case "theLunchStartTime":
                    focuselmnt = elemenetIdForField.replace('theLunchStartTime', 'theLunchEndTime');
                    break;
                case "theLunchEndTime":
                    focuselmnt = elemenetIdForField.replace('theLunchEndTime', 'theLunch');
                    break;
                case "theLunch":
                    focuselmnt = elemenetIdForField.replace('theLunch', 'theBillSiteTime');
                    break;
                case "theBillSiteTime":
                    focuselmnt = elemenetIdForField.replace('theBillSiteTime', 'theBillingStartTime');
                    break;
                case "theBillingStartTime":
                    focuselmnt = elemenetIdForField.replace('theBillingStartTime', 'theBillingEndTime');
                    break;
                case "theBillingEndTime":
                    focuselmnt = elemenetIdForField.replace('theBillingEndTime', 'theLQuantity');
                    break;
                case "theLQuantity":
                    focuselmnt = elemenetIdForField.replace('theLQuantity', 'theRegularHour');
                    break;
                case "theRegularHour":
                    focuselmnt = elemenetIdForField.replace('theRegularHour', 'theOvertimeHour');
                    break;
                case "theOvertimeHour":
                    focuselmnt = elemenetIdForField.replace('theOvertimeHour', 'thePremiumHours');
                    break;
                case "thePremiumHours":
                    focuselmnt = elemenetIdForField.replace('thePremiumHours', 'theRegularRate');
                    break;
                case "theRegularRate":
                    focuselmnt = elemenetIdForField.replace('theRegularRate', 'theOvertimeRate');
                    break;
                case "theOvertimeRate":
                    focuselmnt = elemenetIdForField.replace('theOvertimeRate', 'thePremiumRate');
                    break;
                case "thePremiumRate":
                    focuselmnt = elemenetIdForField.replace('thePremiumRate', 'theLUOM');
                    break;
                case "theLUOM":
                    focuselmnt = elemenetIdForField.replace('theLUOM', 'theTaxGroup');
                    break;
                case "theTaxGroup":
                    focuselmnt = elemenetIdForField.replace('theTaxGroup', 'theOverTime');
                    break;

                //Equipment Lines
                case "theEBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theEBillasLumpSum', 'theENonBillable');
                    break;
                case "theENonBillable":
                    focuselmnt = elemenetIdForField.replace('theENonBillable', 'theEQuantity');
                    break;
                case "theEQuantity":
                    focuselmnt = elemenetIdForField.replace('theEQuantity', 'theEUOM');
                    break;
                case "theEUOM":
                    focuselmnt = elemenetIdForField.replace('theEUOM', 'theEBillasLumpSum');
                    break;
                case "theEUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theEUnitPrice', 'theETaxGroup');
                    break;
                case "theETaxGroup":
                    focuselmnt = elemenetIdForField.replace('theETaxGroup', 'thePickUpRental');
                    break;
                case "thePickUpRental":
                    focuselmnt = elemenetIdForField.replace('thePickUpRental', 'thePickUpRO');
                    break;
                case "thePickUpRO":
                    focuselmnt = elemenetIdForField.replace('thePickUpRO', 'theDropOffRental');
                    break;
                // Material
                case "theMBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theMBillasLumpSum', 'theMNonBillable');
                    break;
                case "theMNonBillable":
                    focuselmnt = elemenetIdForField.replace('theMNonBillable', 'theMResource');
                    break;
                case "theMResource":
                    focuselmnt = elemenetIdForField.replace('theMResource', 'theMDescription');
                    break;
                case "theMDescription":
                    theMDescription
                    focuselmnt = elemenetIdForField.replace('theMDescription', 'theMQuantity');
                    break;
                case "theMQuantity":
                    focuselmnt = elemenetIdForField.replace('theMQuantity', 'theMUOM');
                    break;
                case "theMUOM":
                    focuselmnt = elemenetIdForField.replace('theMUOM', 'theMUnitPrice');
                    break;
                case "theMUOM":
                    focuselmnt = elemenetIdForField.replace('theMUOM', 'theMUnitPrice');
                    break;
                case "theMUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theMUnitPrice', 'theMTaxGroup');
                    break;
                case "theMTaxGroup":
                    focuselmnt = elemenetIdForField.replace('theMTaxGroup', 'theMBillasLumpSum');
                    break;


                //Subcontractor
                case "theSBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theSBillasLumpSum', 'theSNonBillable');
                    break;
                case "theSNonBillable":
                    focuselmnt = elemenetIdForField.replace('theSNonBillable', 'theSResource');
                    break;
                case "theSResource":
                    focuselmnt = elemenetIdForField.replace('theSResource', 'theSQuantity');
                    break;
                case "theSQuantity":
                    focuselmnt = elemenetIdForField.replace('theSQuantity', 'theSUOM');
                    break;
                case "theSUOM":
                    focuselmnt = elemenetIdForField.replace('theSUOM', 'theSUnitPrice');
                    break;
                case "theSUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theSUnitPrice', 'theSMarkupOption');
                    break;
                case "theSMarkupOption":
                    focuselmnt = elemenetIdForField.replace('theSMarkupOption', 'theSMarkup');
                    break;
                case "theSMarkup":
                    focuselmnt = elemenetIdForField.replace('theSMarkup', 'theSTaxGroup');
                    break;
                case "theSTaxGroup":
                    focuselmnt = elemenetIdForField.replace('theSTaxGroup', 'theSBillasLumpSum');
                    break;



                //Waste Disposal
                case "theWBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theWBillasLumpSum', 'theWNonBillable');
                    break;
                case "theWNonBillable":
                    focuselmnt = elemenetIdForField.replace('theWNonBillable', 'theWResource');
                    break;
                case "theWResource":
                    focuselmnt = elemenetIdForField.replace('theWResource', 'theWDescription');
                    break;
                case "theWDescription":
                    focuselmnt = elemenetIdForField.replace('theWDescription', 'theWQuantity');
                    break;
                case "theWQuantity":
                    focuselmnt = elemenetIdForField.replace('theWQuantity', 'theWUOM');
                    break;
                case "theWUOM":
                    focuselmnt = elemenetIdForField.replace('theWUOM', 'theWBOLManifest');
                    break;
                case "theWBOLManifest":
                    focuselmnt = elemenetIdForField.replace('theWBOLManifest', 'theWFacility');
                    break;
                case "theWFacility":
                    focuselmnt = elemenetIdForField.replace('theWFacility', 'theWUnitPrice');
                    break;
                case "theWUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theWUnitPrice', 'theWMarkupOption');
                    break;
                case "theWMarkupOption":
                    focuselmnt = elemenetIdForField.replace('theWMarkupOption', 'theWMarkup');
                    break;
                case "theWMarkup":
                    focuselmnt = elemenetIdForField.replace('theWMarkup', 'theWTaxGroup');
                    break;
                case "theWTaxGroup":
                    focuselmnt = elemenetIdForField.replace('theWTaxGroup', 'theWBillasLumpSum');
                    break;


                //Demurrage
                case "theDBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theDBillasLumpSum', 'theDNonBillable');
                    break;
                case "theDNonBillable":
                    focuselmnt = elemenetIdForField.replace('theDNonBillable', 'theDResource');
                    break;
                case "theDResource":
                    focuselmnt = elemenetIdForField.replace('theDResource', 'theDDescription');
                    break;
                case "theDDescription":
                    focuselmnt = elemenetIdForField.replace('theDDescription', 'theDSiteStartTime');
                    break;
                case "theDSiteStartTime":
                    focuselmnt = elemenetIdForField.replace('theDSiteStartTime', 'theDSiteEndTime');
                    break;
                case "theDSiteEndTime":
                    focuselmnt = elemenetIdForField.replace('theDSiteEndTime', 'theDQuantity');
                    break;
                case "theDQuantity":
                    focuselmnt = elemenetIdForField.replace('theDQuantity', 'theDUOM');
                    break;
                case "theDUOM":
                    focuselmnt = elemenetIdForField.replace('theDUOM', 'theDUnitPrice');
                    break;
                case "theDUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theDUnitPrice', 'theDFuelSurcharge');
                    break;
                case "theDFuelSurcharge":
                    focuselmnt = elemenetIdForField.replace('theDFuelSurcharge', 'theDTaxGroup');
                    break;
                case "theDTaxGroup":
                    focuselmnt = elemenetIdForField.replace('theDTaxGroup', 'theDBillasLumpSum');
                    break;


                //Lump Sum
                case "theLumpSumResourceType":
                    focuselmnt = elemenetIdForField.replace('theLumpSumResourceType', 'theLumpDescription');
                    break;
                case "theLumpDescription":
                    focuselmnt = elemenetIdForField.replace('theLumpDescription', 'theLumpQuantity');
                    break;
                case "theLumpQuantity":
                    focuselmnt = elemenetIdForField.replace('theLumpQuantity', 'theLumpUOM');
                    break;
                case "theLumpUOM":
                    focuselmnt = elemenetIdForField.replace('theLumpUOM', 'theLumpUnitPrice');
                    break;
                case "theLumpUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theLumpUnitPrice', 'theLumpTaxGroup');
                    break;


                //Misc
                case "theMiscBillasLumpSum":
                    focuselmnt = elemenetIdForField.replace('theMiscBillasLumpSum', 'theMiscNonBillable');
                    break;
                case "theMiscNonBillable":
                    focuselmnt = elemenetIdForField.replace('theMiscNonBillable', 'theMiscResource');
                    break;
                case "theMiscResource":
                    focuselmnt = elemenetIdForField.replace('theMiscResource', 'theMiscDescription');
                    break;
                case "theMiscDescription":
                    focuselmnt = elemenetIdForField.replace('theMiscDescription', 'theMiscQuantity');
                    break;
                case "theMiscQuantity":
                    focuselmnt = elemenetIdForField.replace('theMiscQuantity', 'theMiscUOM');
                    break;
                case "theMiscUOM":
                    focuselmnt = elemenetIdForField.replace('theMiscUOM', 'theMiscUnitPrice');
                    break;
                case "theMiscUnitPrice":
                    focuselmnt = elemenetIdForField.replace('theMiscUnitPrice', 'theMiscTaxGroup');
                    break;
                case "theMiscTaxGroup":
                    focuselmnt = elemenetIdForField.replace('theMiscTaxGroup', 'theMiscBillasLumpSum');
                    break;

            }
        }

        function setFocus() {
            document.getElementById(focuselmnt).focus();
        }

        /*function validateTaxArea(ctrl) {
                    validateTaxArea();
                }*/

        function validateContacts(ctrl) {
            validateContacts();
        }

        function validateTaxLiable(ctrl) {
            validateTaxLiable();
        }

        function validateSalesOrder(ctrl) {
            validateSalesOrder();
        }

        function validateAltSiteAddress(ctrl) {
            validateAltSiteAddress();
        }

        function setScheduleDate() {
            setScheduleDate();
        }

        //function validateTMCompleted(ctrl) {
        //    validateTMCompleted();
        //}

        function isNumber(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        function insertColon(ctrl, evt) {
            var anc = ctrl;
            //if(ctrl.value.length == 2 && evt.keyCode != 8) {
            //    ctrl.value = ctrl.value + ':';
            //}

            if (ctrl.value.length >= 3 && ctrl.value.indexOf(':') < 0) {
                switch (ctrl.value.length) {
                    case 3:
                        ctrl.value = ctrl.value.substr(0, 2) + ':' + ctrl.value.substr(2, 1);
                        break;
                    default:
                        ctrl.value = ctrl.value.substr(0, 2) + ':' + ctrl.value.substr(2, ctrl.value.length - 2);
                        break;
                }
            }
        }

        function validateStartTime(ctrl) {
            validateStartTime();
        }

        function setWidth() {
            $(".tmLineWrap").css("max-width", (screen.width - 100));
        }

    </script>
    <c:LoadingStatus />
    <apex:sectionHeader title="Sales Order" subtitle="{!salesOrder.Name}"/>
    <apex:form id="theForm">
        <apex:outputPanel id="refreshsections">
            <apex:pageBlock id="thePageBlock">
                <apex:pageMessages id="theMessage"></apex:pageMessages>
                <apex:pageBlockButtons >
                    <apex:commandButton value="Invoice All" action="{!invoiceAll}" rerender="theForm"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Invoice None" action="{!invoiceNone}" rerender="theForm"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Lump Sum All" action="{!lumpSumAll}" rerender="theForm"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Lump Sum None" action="{!lumpSumNone}" rerender="theForm"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Non-Billable All" action="{!nonBillableAll}" rerender="theForm"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Non-Billable None" action="{!nonBillableNone}" rerender="theForm"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Save" action="{!saveSection}" rerender="theForm" status="loadingstatus"/>
                    <apex:commandButton value="Quick Save" action="{!quickSaveSection}" rerender="thePageBlock"
                                        status="loadingstatus"/>
                    <apex:commandButton value="Cancel" action="{!cancelTMSection}" rerender="theForm"
                                        status="loadingstatus"/>
                </apex:pageBlockButtons>

                <apex:actionFunction name="validateField" action="{!validateTMField}"
                                     oncomplete="setWidth();setFocus();"
                                     reRender="thePageBlock,theLaborSection,theMaterialsSection,theEquipmentSection,theSubcontractorsSection, theFieldRemediationSection, theWasteDisposalSection, theDemurrageSection, theLumpSumSection, theMiscSection, theMessage,theMessage2"
                                     immediate="true" status="loadingstatus">
                    <apex:param value="" name="fieldName"/>
                    <apex:param value="" name="newFieldValue"/>
                    <apex:param value="" name="lineNo"/>
                </apex:actionFunction>
                <apex:actionFunction name="CalculateTotalLaborTMLines" action="{!CalculateTotalLaborTMLines}"
                                     oncomplete="setWidth();setFocus();"
                                     reRender="thePageBlock, theMessage,theMessage2"
                                     immediate="false" status="loadingstatus">
                </apex:actionFunction>
                <apex:panelGrid columns="5" cellpadding="5">
                    <apex:outputPanel >
                        <b>Field to Filter : </b>
                        <apex:selectList size="1" value="{!selFilterField}">
                            <apex:selectOptions value="{!lstFilterField}"/>
                        </apex:selectList>
                    </apex:outputPanel>
                    <apex:outputPanel >
                        <apex:selectList size="1" value="{!selFilterOp}">
                            <apex:selectOptions value="{!lstFilterOperator}"/>
                        </apex:selectList>
                    </apex:outputPanel>
                    <apex:outputPanel >
                        <apex:inputText value="{!filterInput}"/>
                    </apex:outputPanel>
                    <apex:outputPanel >
                        <apex:commandButton value="Filter" action="{!filterReviewTMSection}" status="loadingStatus"
                                            rerender="thePageBlock,pgStat">
                            <apex:param id="theSearch" name="theSearch" value="Item"/>
                        </apex:commandButton>
                        <apex:outputPanel id="pgStat">
                            {!paginationStat}&nbsp;&nbsp;
                        </apex:outputPanel>
                    </apex:outputPanel>
                    <apex:outputPanel >
                        <apex:panelGrid styleClass="pagination-buttons" columns="5" style="display:inline-block;">
                            <apex:commandButton action="{!first}" disabled="{!!hasPrevious}" value="|<< First"
                                                reRender="thePageBlock"/>
                            <apex:commandButton action="{!previous}" disabled="{!!hasPrevious}" value="<< Previous"
                                                reRender="thePageBlock"/>
                            <apex:commandButton action="{!next}" disabled="{!!hasNext}" value="Next >>"
                                                reRender="thePageBlock"/>
                            <apex:commandButton action="{!last}" disabled="{!!hasNext}" value="Last >>|"
                                                reRender="thePageBlock"/>
                        </apex:panelGrid>
                    </apex:outputPanel>
                </apex:panelGrid>

                <apex:outputPanel id="theLaborOutputPanel" rendered="{!addLineCategory == 'Labor'}">
                    <apex:pageBlockSection id="theLaborSection" columns="1"
                                           title="Labor Lines" collapsible="true">
                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable styleClass="brdrTable" border="1" cellpadding="5" cellspacing="5" style=""
                                            id="theTMLLaborTable" value="{!theTMLListLabor}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListLabor))}">
                                <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                    <apex:commandButton value="Delete" disabled="true"
                                                        onclick="if(!confirmDelete()){return false};"
                                                        oncomplete="setWidth();" action="{!deleteTMLine}"
                                                        reRender="theTMLLaborTable,refreshsections"
                                                        status="loadingstatus">
                                        <apex:param id="objectType" name="objectType" value="TMLine"/>
                                        <apex:param id="displayId" name="displayId" value="{!line.Line_No__c}"/>
                                        <apex:param id="lineType" name="lineType" value="Labor"/>
                                    </apex:commandButton>


                                    <apex:commandButton value="Copy Billing Time"
                                                        onclick="if(!confirmCopyTime('Labor')){return false};"
                                                        oncomplete="setWidth();" action="{!copyTime}"
                                                        reRender="theTMLLaborTable, theMessage, theMessage2"
                                    >
                                        <apex:param id="objectTypeCopy_bill" name="objectType" value="TMLine"/>
                                        <apex:param id="displayIdCopy_bill" name="displayId"
                                                    value="{!line.Line_No__c}"/>
                                        <apex:param id="lineTypeCopy_bill" name="lineType" value="Labor"/>
                                        <apex:param id="timeTypeCopy_bill" name="timeType" value="BillingTime"/>
                                        <apex:param id="tm_id" name="tmId" value="{!line.TM__c}"/>
                                    </apex:commandButton>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLToInvoice"
                                                     value="{!line.To_Invoice__c}">

                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLNonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource_Type__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Labor Type"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField value="{!line.Resource_Type__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Service_Center__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="SC"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Service_Center__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Labor"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Resource__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource_Name__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Labor Name"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theResourceName" value="{!line.Resource_Name__c}"
                                                     rendered="{!line.Resource__r.Employee_No__c == null}"/>
                                    <apex:outputText value="{!line.Resource_Name__c}"
                                                     rendered="{!line.Resource__r.Employee_No__c != null}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_Site_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_Site_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theBillSiteTime" value="{!line.Bill_Site_Time__c}"
                                    />
                                </apex:column>

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Include_Lunch_Y_N__c.Label}">
                                    <apex:inputField id="theLInclLunchYN" value="{!line.Include_Lunch_Y_N__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Billing_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Billing_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theBillingStartTime"
                                                     onkeyup="insertColon(this, event);"
                                                     onkeypress="return isNumber(event);"
                                                     value="{!line.Billing_Start_Time__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Billing_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Billing_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theBillingEndTime"
                                                     onkeyup="insertColon(this, event);"
                                                     onkeypress="return isNumber(event);"
                                                     value="{!line.Billing_End_Time__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Hour__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Hour__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theHour" value="{!line.Hour__c}" style="width:60px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLQuantity"
                                                     value="{!line.Quantity__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Regular_Hours__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Regular_Hours__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theRegularHour"
                                                     value="{!line.Regular_Hours__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Overtime_Hours__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Overtime_Hours__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theOvertimeHour"
                                                     value="{!line.Overtime_Hours__c}"/>
                                </apex:column>


                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Premium_Hours__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Premium_Hours__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="thePremiumHours"
                                                     value="{!line.Premium_Hours__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Regular_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Regular_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theRegularRate"
                                                     value="{!line.Regular_Rate__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Overtime_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Overtime_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theOvertimeRate"
                                                     value="{!line.Overtime_Rate__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Premium_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Premium_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="thePremiumRate"
                                                     value="{!line.Premium_Rate__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineAmount" value="{!line.Line_Amount__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineAmountInclTax" value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Job_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Job_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Job_Start_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Site_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Site_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Site_Start_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Site_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Site_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Site_End_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Job_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Job_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Job_End_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Lunch_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Lunch_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Lunch_Start_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Lunch_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Lunch_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Lunch_End_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Lunch__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Lunch__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Lunch__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Overtime__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Overtime__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theOverTime" value="{!line.Overtime__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Total_Job_Hours__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Total_Job_Hours__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theTotalJobHours" value="{!line.Total_Job_Hours__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Total_Site_Hours__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Total_Site_Hours__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theTotalSiteHours" value="{!line.Total_Site_Hours__c}"/>
                                </apex:column>
                                <apex:column >

                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputpanel >
                                        <c:CustomLookup componentId="{!$Component.theTMLLaborTable}:theLContractLine"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Customer_Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="TM_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Contract_Line__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Contract_Line__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="CLFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1="Resource_Type_Category__c"
                                                        FilterNameValue1="Labor"
                                                        FilterOperation1="Resource_Type_Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Resource_Type_Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Resource_Type__c"
                                                        FilterNameValue2="{!line.Resource_Type__c}"
                                                        FilterOperation2="Resource_Type__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Resource_Type__c"
                                                        FilterTypeValue2="String"

                                                        FilterName3="Contract__c"
                                                        FilterNameValue3="{!line.TM__r.Contract__c}"
                                                        FilterOperation3="Contract__c"
                                                        FilterOperationValue3="="
                                                        FilterType3="Contract__c"
                                                        FilterTypeValue3="String"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                        />
                                    </apex:outputpanel>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Regular_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Regular_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theContractRegularRate"
                                                      value="{!line.Contract_Regular_Rate__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Overtime_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Overtime_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theContractOvertimeRate"
                                                      value="{!line.Contract_Overtime_Rate__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Premium_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Premium_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theContractPremiumRate"
                                                      value="{!line.Contract_Premium_Rate__c}"/>
                                </apex:column>
                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}" oncomplete="setWidth();"
                                            reRender="theLaborSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Labor"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLLaborTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>



                <apex:outputPanel rendered="{!addLineCategory == 'Equipment'}">
                    <apex:pageBlockSection id="theEquipmentSection" columns="1"
                                           title="Equipment Lines" collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLEquipmentTable" value="{!theTMLListEquipment}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListEquipment))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theEToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theEBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theENonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource_Type__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Equipment Type"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField value="{!line.Resource_Type__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Service_Center__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="SC"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Service_Center__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Equipment"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Resource__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource_Name__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Equipment Name"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theResourceName" value="{!line.Resource_Name__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Fleet_No_Required__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Fleet_No_Required__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Fleet_No_Required__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Fleet_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Fleet_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theEFleetNumber" value="{!line.Fleet_No__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Job_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Job_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theESiteStartTime"
                                                     onkeyup="insertColon(this, event);"
                                                     onkeypress="return isNumber(event);"
                                                     value="{!line.Job_Start_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Job_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Job_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theESiteEndTime"
                                                     onkeyup="insertColon(this, event);"
                                                     onkeypress="return isNumber(event);"
                                                     value="{!line.Job_End_Time__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Hour__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Hour__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theHour" value="{!line.Hour__c}" style="width:60px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theEQuantity" value="{!line.Quantity__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theEUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theETaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:outputpanel >
                                        <c:CustomLookup componentId="{!$Component.theTMLEquipmentTable}:theEContractLine"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Name"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="TM_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Contract_Line__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Contract_Line__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="CLFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1="Resource_Type_Category__c"
                                                        FilterNameValue1="Equipment"
                                                        FilterOperation1="Resource_Type_Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Resource_Type_Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Resource_Type__c"
                                                        FilterNameValue2="{!line.Resource_Type__c}"
                                                        FilterOperation2="Resource_Type__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Resource_Type__c"
                                                        FilterTypeValue2="String"

                                                        FilterName3="Contract__c"
                                                        FilterNameValue3="{!line.TM__r.Contract__c}"
                                                        FilterOperation3="Contract__c"
                                                        FilterOperationValue3="="
                                                        FilterType3="Contract__c"
                                                        FilterTypeValue3="String"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                        />
                                    </apex:outputpanel>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Regular_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Regular_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theEContractRegularRate"
                                                      value="{!line.Contract_Regular_Rate__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Rental_Allowed__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Rental_Allowed__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Rental_Allowed__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Pick_Up_Rental__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Pick_Up_Rental__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="thePickUpRental" value="{!line.Pick_Up_Rental__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Pick_Up_R_O__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Pick Up R/O No"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="thePickUpRO" value="{!line.Pick_Up_R_O__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Drop_Off_Rental__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Drop_Off_Rental__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDropOffRental" value="{!line.Drop_Off_Rental__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Drop_Off_R_O__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Drop Off R/O No."/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theDropOffRO" value="{!line.Drop_Off_R_O__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Job_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Job_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Job_Start_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Job_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Job_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Job_End_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLEquipmentTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Total_Job_Hours__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Total_Job_Hours__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Total_Job_Hours__c}"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            oncomplete="setWidth();"
                                            reRender="theEquipmentSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Equipment"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLEquipmentTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>


                <apex:outputPanel rendered="{!addLineCategory == 'Materials'}">
                    <apex:pageBlockSection id="theMaterialsSection" columns="1"
                                           title="Material Lines" collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLMaterialsTable" value="{!theTMLListMaterials}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListMaterials))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMNonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Material"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Resource__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Billing Description"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMQuantity"
                                                     value="{!line.Quantity__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:outputpanel >
                                        <c:CustomLookup componentId="{!$Component.theTMLMaterialsTable}:theMContractLine"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Name"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="TM_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Contract_Line__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Contract_Line__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="CLFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1="Resource_Category__c"
                                                        FilterNameValue1="Materials"
                                                        FilterOperation1="Resource_Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Resource_Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Resource__c"
                                                        FilterNameValue2="{!line.Resource__c}"
                                                        FilterOperation2="Resource__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Resource__c"
                                                        FilterTypeValue2="String"

                                                        FilterName3="Contract__c"
                                                        FilterNameValue3="{!line.TM__r.Contract__c}"
                                                        FilterOperation3="Contract__c"
                                                        FilterOperationValue3="="
                                                        FilterType3="Contract__c"
                                                        FilterTypeValue3="String"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                        />
                                    </apex:outputpanel>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMaterialsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Regular_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Regular_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theMContractRegularRate"
                                                      value="{!line.Contract_Regular_Rate__c}"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            reRender="theMaterialsSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Materials"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLMaterialsTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>



                <apex:outputPanel rendered="{!addLineCategory == 'Subcontractors'}">
                    <apex:pageBlockSection id="theSubcontractorsSection"
                                           columns="1" title="Cost Plus Materials, Equipment, and Services"
                                           collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLSubcontractorsTable" value="{!theTMLListSubcontractors}"
                                            var="line"
                                            rendered="{!NOT(ISNULL(theTMLListSubcontractors))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>


                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSNonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSQuantity" value="{!line.Quantity__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:outputpanel >
                                        <div class="requiredInput">
                                            <div class="requiredBlock"></div>
                                            <c:CustomLookup componentId="{!$Component.theTMLSubcontractorsTable}:theSUOM"
                                                            styleClass="input-lookup"
                                                            style="width: 100px"
                                                            secondaryDisplayField="Description__c"
                                                            minSearchLength="1"
                                                            stealFocus="true"
                                                            sObjectType="TM_Line__c"
                                                            sObject="{!line}"
                                                            sObjectField="Unit_of_Measure__c"
                                                            onchange="validateFieldInList(this);"

                                                            allowtoBlank="true"
                                                            LookupObject="Unit_of_Measure__c"
                                                            LinkFieldName="Name"
                                                            FieldSetName="UOMFieldSet"
                                                            RunValidation="True"
                                                            LookupType="ID"
                                                            ValidateFunction="validateField"

                                                            fltr1="true"
                                                            fltr2="true"
                                                            fltr3="true"
                                                            fltr4="true"
                                                            fltr5="true"
                                                            fltr6="true"
                                                            fltr7="true"
                                            />
                                        </div>

                                    </apex:outputpanel>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Markup_Option__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Markup_Option__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSMarkupOption" value="{!line.Markup_Option__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Markup__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Markup__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSMarkup" value="{!line.Markup__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theSTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>



                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLSubcontractorsTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            reRender="theSubcontractorsSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Subcontractors"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLSubcontractorsTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>

                <apex:outputPanel rendered="{!addLineCategory == 'Waste Disposal'}">
                    <apex:pageBlockSection id="theWasteDisposalSection"
                                           columns="1" title="Waste Disposal Lines"
                                           collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLWasteDisposalTable" value="{!theTMLListWasteDisposal}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListWasteDisposal))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWNonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Waste Disposal"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Resource__c}"
                                                     rendered="{!NOT(line.TM__r.Status__c == 'Fully Invoiced'  || line.TM__r.Status__c == 'Closed' || line.TM__r.Status__c == 'Void')}"/>
                                    <apex:outputField value="{!line.Resource__c}"
                                                      rendered="{!line.TM__r.Status__c == 'Fully Invoiced'  || line.TM__r.Status__c == 'Closed' || line.TM__r.Status__c == 'Void'}"/>
                                </apex:column>


                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWQuantity" value="{!line.Quantity__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.BOL_Manifest__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="BOL_Manifest__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.BOL_Manifest__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWBOLManifest" value="{!line.BOL_Manifest__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Facility__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Facility__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWFacility" value="{!line.Facility__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Markup_Option__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Markup_Option__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWMarkupOption" value="{!line.Markup_Option__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Markup__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Markup__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWMarkup" value="{!line.Markup__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theWTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>



                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLWasteDisposalTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            reRender="theWasteDisposalSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Waste Disposal"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLWasteDisposalTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>

                <apex:outputPanel rendered="{!addLineCategory == 'Demurrage'}">
                    <apex:pageBlockSection id="theDemurrageSection" columns="1"
                                           title="Transportation, Demurrage, Fuel Surcharge and Fees"
                                           collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLDemurrageTable" value="{!theTMLListDemurrage}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListDemurrage))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDNonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >

                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Service"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Resource__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Site_Start_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Site_Start_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDSiteStartTime"
                                                     onkeyup="insertColon(this, event);"
                                                     onkeypress="return isNumber(event);"
                                                     value="{!line.Site_Start_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Site_End_Time__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Site_End_Time__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDSiteEndTime"
                                                     onkeyup="insertColon(this, event);"
                                                     onkeypress="return isNumber(event);"
                                                     value="{!line.Site_End_Time__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Hour__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Hour__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theHour" value="{!line.Hour__c}" style="width:60px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDQuantity" value="{!line.Quantity__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Fuel_Surcharge__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Fuel_Surcharge__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDFuelSurcharge" value="{!line.Fuel_Surcharge__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theDTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>


                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLDemurrageTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            reRender="theDemurrageSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Demurrage"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLDemurrageTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>


                <apex:outputPanel rendered="{!addLineCategory == 'Lump Sum'}">
                    <apex:pageBlockSection id="theLumpSumSection" columns="1"
                                           title="Lump Sum/Bundled Lines" collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLLumpSumTable" value="{!theTMLListLumpSum}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListLumpSum))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLumpToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource_Type__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Resource Type"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Resource_Type__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Resource No."/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.Resource__c}"/>
                                </apex:column>

                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLumpDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLumpQuantity" value="{!line.Quantity__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLumpUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >

                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputpanel >
                                        <c:CustomLookup componentId="{!$Component.theTMLLumpSumTable}:theLumpSumContractLine"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Name"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="TM_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Contract_Line__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Contract_Line__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="CLFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1="Resource_Type_Category__c"
                                                        FilterNameValue1="Lump Sum"
                                                        FilterOperation1="Resource_Type_Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Resource_Type_Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Resource_Type__c"
                                                        FilterNameValue2="{!line.Resource_Type__c}"
                                                        FilterOperation2="Resource_Type__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Resource_Type__c"
                                                        FilterTypeValue2="String"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                        />
                                    </apex:outputpanel>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Contract_Regular_Rate__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Contract_Regular_Rate__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theContractRegularRate"
                                                      value="{!line.Contract_Regular_Rate__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theLumpTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLumpSumTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            reRender="theLumpSumSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Lump Sum"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLLumpSumTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                    <div style="clear:both;">
                    </div>
                </apex:outputPanel>

                <apex:outputPanel rendered="{!addLineCategory == 'Misc. Charges And Taxes'}">
                    <apex:pageBlockSection id="theMiscSection" columns="1" title="Miscellaneous Charges And Taxes Lines"
                                           collapsible="true">

                        <apex:outputPanel styleClass="tmLineWrap" layout="block">
                            <apex:dataTable border="1" cellpadding="5" cellspacing="5" width="100%"
                                            styleClass="brdrTable"
                                            id="theTMLMiscTable" value="{!theTMLListMisc}" var="line"
                                            rendered="{!NOT(ISNULL(theTMLListMisc))}">

                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Delete__c.Label}">
                                    <apex:inputField value="{!line.Delete__c}"/>
                                </apex:column>
                                <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}">
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="To_Invoice__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.To_Invoice__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscToInvoice"
                                                     value="{!line.To_Invoice__c}">
                                    </apex:inputField>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Bill_as_Lump_Sum__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Bill_as_Lump_Sum__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscBillasLumpSum" value="{!line.Bill_as_Lump_Sum__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Non_Billable__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Non_Billable__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscNonBillable" value="{!line.Non_Billable__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.TM__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLLaborTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="TM Line"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputLink value="{!URLFOR($Action.TM_Line__c.View, line.Id)}">{!line.Name}
                            </apex:outputLink>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="TM__r.Scheduled_Date__c"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Schedule Date"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField value="{!line.TM__r.Scheduled_Date__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_No__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                                </apex:column>
                                <apex:column >

                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Resource__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;" value="Service"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Resource__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Description__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Description__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscDescription" value="{!line.Description__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Quantity__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscQuantity" value="{!line.Quantity__c}"
                                    />
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_of_Measure__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_of_Measure__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>

                                    <apex:inputField value="{!line.Unit_of_Measure__c}"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Unit_Price__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Unit_Price__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscUnitPrice" value="{!line.Unit_Price__c}"
                                                     style="width:60px"
                                                     styleClass="UnitPrice input-numeric"/>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Tax_Group__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Tax_Group__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theMiscTaxGroup" value="{!line.Tax_Group__c}"
                                                     style="width:60px"
                                                     styleClass="input-description"/>
                                </apex:column>



                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amount__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amount__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amount__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Line_Amt_Incl_Tax__c"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Line_Amt_Incl_Tax__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                     styleClass="LineCost output-numeric" style="width:60px">
                                        <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column >
                                    <apex:facet name="header">
                                        <apex:commandLink reRender="theTMLMiscTable" action="{!setOrderBy}"
                                                          status="loadingstatus">
                                            <apex:param name="orderBy" value="Sales_Line__r.Name"/>
                                            <apex:outputLabel style="cursor:pointer;"
                                                              value="{!$ObjectType.TM_Line__c.fields.Sales_Line__c.Label}"/>
                                        </apex:commandLink>
                                    </apex:facet>
                                    <apex:inputField id="theQuoteLine" value="{!line.Sales_Line__c}"
                                                     style="width: 100px"/>
                                </apex:column>

                            </apex:dataTable>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                    <apex:outputPanel >
                        <apex:commandButton value="Add Lines" action="{!goToReviewAddTMLine}"
                                            reRender="theMiscSection,theMessage">
                            <apex:param name="ObjectType" value="TMLine"/>
                            <apex:param name="LineCategory" value="Misc. Charges And Taxes"/>
                        </apex:commandButton>
                    </apex:outputPanel>
                    <div style="float:right;font-size:150%;width:1000px">
                        <apex:pageBlockSection id="TMLMiscTotal" columns="7">
                            <apex:outputText label="To Invoice: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLines}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotal}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotal}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotal}"/>
                            </apex:outputText>

                            <apex:outputText label="All: " styleClass="output-numeric">
                            </apex:outputText>
                            <apex:outputText label="Lines: " value="{0, number, ###,##0}" styleClass="output-numeric">
                                <apex:param value="{!TMLLinesIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="SubTotal: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLSubtotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Margin: {0, number, ###,##0.00}%" styleClass="output-numeric">
                                <apex:param value="{!TMLProfitMarginIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText value="Cost: {0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTotalCostIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Tax: " value="{0, number, ###,##0.00}" styleClass="output-numeric">
                                <apex:param value="{!TMLTaxTotalIncludeAll}"/>
                            </apex:outputText>
                            <apex:outputText label="Total: " value="{0, number, ###,##0.00}"
                                             styleClass="output-numeric">
                                <apex:param value="{!TMLTotalIncludeAll}"/>
                            </apex:outputText>
                        </apex:pageBlockSection>
                    </div>
                </apex:outputPanel>

                <div style="clear:both;">

                </div>
                <script>

                    $(".tmLineWrap").css("max-width", (screen.width - 100));

                </script>
            </apex:pageBlock>
        </apex:outputPanel>
    </apex:form>
    -->
</apex:page>