<apex:page language="{!$CurrentPage.parameters.lang}" standardController="Sales_Order__c"
           extensions="SalesOrderController" id="thePage" sidebar="false" lightningStyleSheets="false" docType="html-5.0">
    <!--
    <apex:stylesheet value="{!URLFOR($Resource.GoldFinch, '/css/style.css')}"/>
    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="{!URLFOR($Resource.Typeahead, '/typeahead.bundle.min.js')}"></script>
    <script>
        $ = jQuery.noConflict();
        var focuselmnt;

        function validateFieldInList(fieldThatChanged) {
            //debugger;
            var elementIdForField = fieldThatChanged.id;
            var lastColonPosition = elementIdForField.lastIndexOf(':');
            var secondToLastColonPosition = elementIdForField.lastIndexOf(':', lastColonPosition - 1);
            var fieldName = (elementIdForField.substr(lastColonPosition + 1));
            var lineNo = (elementIdForField.substr(secondToLastColonPosition + 1, (lastColonPosition - secondToLastColonPosition) - 1));
            //Ticket 13395,
            //Tikcet 13810 add theMiscResource
            if (fieldName == 'theJobPositionINPT' || fieldName == 'theLLUOM' || fieldName == 'theMLUOM' || fieldName == 'theELUOM' || fieldName == 'theLumpUOM'
                || fieldName == 'theDUOM' || fieldName == 'theMiscUOM' || fieldName == 'theMiscResource'
                || fieldName == 'theMaterialINPT' || fieldName == 'theEquipmentINPT' || fieldName == 'theSResource' || fieldName == 'theLContractLine'
                || fieldName == 'theEContractLine' || fieldName == 'theMContractLine' || fieldName == 'theLumpSumResourceType' || fieldName == 'theLumpSumContractLine'
                || fieldName == 'theWUOM' || fieldName == 'theDResource' || fieldName == 'theTaxArea' || fieldName == 'theWResource'
                || fieldName == 'theWUnitVol' || fieldName == 'theWContainerSize' || fieldName == 'theWFacility') {
                var newFieldValue = document.getElementById(elementIdForField + "_lkid").value;
            }
            // Ticket 14240 AES-431
            else if (fieldName == 'theUsePremiumRate' || fieldName == 'theBillSiteTime' || fieldName == 'theLBillasLumpSum' || fieldName == 'theEBillasLumpSum' ||
                fieldName == 'theMBillasLumpSum' || fieldName == 'theSBillasLumpSum' || fieldName == 'theDBillasLumpSum' || fieldName == 'theMiscBillasLumpSum' ||
                fieldName == 'theWBillasLumpSum' || fieldName == 'theLNonBillable' || fieldName == 'theENonBillable' || fieldName == 'theMNonBillable' ||
                fieldName == 'theSNonBillable' || fieldName == 'theDNonBillable' || fieldName == 'theMiscNonBillable' || fieldName == 'theWNonBillable' ||
                fieldName == 'theInclLunchYN') {
                var newFieldValue = document.getElementById(elementIdForField).checked;
            } else if (fieldName == 'theWCostMethod'){
                var e = document.getElementById(elementIdForField);
                var newFieldValue = e.options[e.selectedIndex].value;
            } else {
                var newFieldValue = document.getElementById(elementIdForField).value;
                focusInputId = null;
            }

            if (fieldName == 'theJobPositionINPT') focuselmnt = elementIdForField.replace('theJobPositionINPT', 'theLQuantity');
            else if (fieldName == 'theMaterialINPT') focuselmnt = elementIdForField.replace('theMaterialINPT', 'theMQuantity');
            else if (fieldName == 'theEquipmentINPT') focuselmnt = elementIdForField.replace('theEquipmentINPT', 'theEQuantity');
            else if (fieldName == 'theLQuantity') focuselmnt = elementIdForField.replace('theLQuantity', 'theLUOMQuantity');
            else if (fieldName == 'theEQuantity') focuselmnt = elementIdForField.replace('theEQuantity', 'theEUOMQuantity');
            else if (fieldName == 'theLUOMQuantity') focuselmnt = elementIdForField.replace('theLUOMQuantity', 'theLUOM');
            else if (fieldName == 'theMQuantity') focuselmnt = elementIdForField.replace('theMQuantity', 'theMUOM');
            else if (fieldName == 'theEUOMQuantity') focuselmnt = elementIdForField.replace('theEUOMQuantity', 'theEUOM');
            else if (fieldName == 'theWQuantity') focuselmnt = elementIdForField.replace('theWQuantity', 'theWUnitPrice');
            else focuselmnt = undefined;

            if(fieldName == 'theTaxArea') {
                lineNo = -1;
                validateTaxArea(fieldName, newFieldValue, lineNo);
            } else if (fieldName == 'theBillToContact'){
                lineNo = -1;

            } else {
            validateField(fieldName, newFieldValue, lineNo);
        }
            //validateField(fieldName, newFieldValue, lineNo);
        }

        /*function validateSalesOrderType(ctrl) {
            validateSalesOrderType();
        }*/

        function validateSalespeople(ctrl) {
            validateSalespeopleFunc();
        }

        function validateAltSiteAddress(ctrl) {
            validateAltSiteAddress();
        }

        function validateCreateSiteAddress(ctrl) {
            validateCreateSiteAddress();
        }

        function validateTaxLiable(ctrl) {
            validateTaxLiable();
        }
    
        function validateFieldPlus(hdnparname, fieldName, newval, lineNo) {

            if (fieldName == 'theJobPositionINPT') focuselmnt = hdnparname + 'theLQuantity';
            else if (fieldName == 'theMaterialINPT') focuselmnt = hdnparname + 'theMQuantity';
            else if (fieldName == 'theEquipmentINPT') focuselmnt = hdnparname + 'theEQuantity';
            else focuselmnt = undefined;

            validateField(fieldName, newval, lineNo);
        }

        function setFocusOnLoad() {
            if (focuselmnt !== undefined) document.getElementById(focuselmnt).focus();
        }
    
        function setWidth() {
            $(".salesLineWrap").css("max-width", (screen.width - 100));
        }

        function changeOwnerCall(fieldThatChanged) {
            var elementIdForField = fieldThatChanged.id;
            var newOwnerId = document.getElementById(elementIdForField + "_lkid").value;
            changeOwner(newOwnerId);
        }
        //Ticket# AES-401
        function validateContactCall(field) {
            var fieldId = field.id;
            var contactId = document.getElementById(fieldId + "_lkid").value;
            validateContact(fieldId, contactId);
        }
        function validateContractCall(field) {
            var fieldId = field.id;
            var contractId = document.getElementById(fieldId + "_lkid").value;
            validateContract(fieldId, contractId);
        }

        function validateRateSheetCall(field) {
            var fieldId = field.id;
            var contractId = document.getElementById(fieldId + "_lkid").value;
            validateRateSheet(fieldId, contractId);
        }



        function validateSalesOrderTypeCall(field) {
            var fieldId = field.id;
            var salesOrderTypeId = document.getElementById(fieldId + "_lkid").value;
            validateSalesOrderType(salesOrderTypeId);
        }
        function validateSurchargeTypeCall(field) {
            var e = document.getElementById(field.id);
            var selectedValue = e.options[e.selectedIndex].value;
            validateSurchargeType(selectedValue);
        }
        function validateQuoteDateCall(field){
            validateQuoteDate();
        }

    </script>

    <c:LoadingStatus />

    <apex:sectionHeader title="{!title}"
                        subtitle="{!Sales_Order__c.Name}{!IF(Sales_Order__c.CMR_Description__c == '', '', '  -----  ' + Sales_Order__c.CMR_Description__c)} {!IF(Sales_Order__c.Approval_Status__c == 'Approved', '', Sales_Order__c.Approval_Status__c)}"
                        id="title"/>
    <apex:form id="theForm">

        <apex:pageBlock id="thePageBlock">
            <apex:pageMessages id="theMessage" escape="false" />
            <apex:pageBlockButtons id="theButton">
                <apex:commandButton value="Cancel" action="{!cancel}" status="loadingstatus" rerender="thePageBlock"/>
            </apex:pageBlockButtons>

            <apex:actionFunction name="validateSalesOrderType" action="{!validateSalesOrderType}"
                                 reRender="thePageBlockSection" immediate="false" status="loadingstatus">
                <apex:param value="" name="salesOrderTypeId"/>
            </apex:actionFunction>
            <apex:actionFunction name="validateSalespeopleFunc" action="{!validateSalespeople}" reRender="thePageBlock"
                                 immediate="false" status="loadingstatus"/>
            <apex:actionFunction name="validateAltSiteAddress" action="{!validateAltSiteAddress}"
                                 reRender="thePageBlock" immediate="false" status="loadingstatus"/>
            <apex:actionFunction name="validateCreateSiteAddress" action="{!validateCreateSiteAddress}"
                                 reRender="thePageBlock" immediate="false" status="loadingstatus"/>
            <apex:actionFunction name="validateTaxLiable" action="{!validateTaxLiable}" reRender="thePageBlock"
                                 immediate="false" status="loadingstatus"/>
            <apex:actionFunction name="validateTaxArea" action="{!validateTaxArea}" reRender="thePageBlock"
                                 immediate="false" status="loadingstatus">
                <apex:param value="" name="fieldName"/>
                <apex:param value="" name="newFieldValue"/>
                <apex:param value="" name="lineNo"/>
            </apex:actionFunction>
            <apex:actionFunction name="validateBillToContact" action="{!validateTaxArea}" reRender="thePageBlock"
                                 immediate="false" status="loadingstatus">
                <apex:param value="" name="fieldName"/>
                <apex:param value="" name="newFieldValue"/>
                <apex:param value="" name="lineNo"/>
            </apex:actionFunction>
            <apex:actionFunction name="changeOwner" action="{!changeOwner}" reRender="theOwner"
                                 immediate="false">
                <apex:param value="" name="newOwnerId"/>
            </apex:actionFunction>

            <apex:actionFunction name="validateContact" action="{!validateContact}" reRender="thePageBlock"
                                 immediate="false">
                <apex:param value="" name="fieldId"/>
                <apex:param value="" name="contactId"/>
            </apex:actionFunction>
            <apex:actionFunction name="validateContract" action="{!validateContract}"
                                 reRender="thePageBlock,theMiscSection,thePageBlock,theSLMiscTable"
                                 status="loadingstatus"
                                 immediate="false">
                <apex:param value="" name="fieldId"/>
                <apex:param value="" name="contractId"/>
            </apex:actionFunction>

            <apex:actionFunction name="validateRateSheet" action="{!validateRateSheet}"
                                 reRender="thePageBlock,theMiscSection,thePageBlock,theSLMiscTable"
                                 status="loadingstatus"
                                 immediate="false">
                <apex:param value="" name="fieldId"/>
                <apex:param value="" name="rateSheetId"/>
            </apex:actionFunction>


            <apex:actionFunction name="validateBillToCustomer" action="{!validateBillToCustomer}" reRender="thePageBlock"
                                 immediate="false" status="loadingstatus"/>

            <apex:actionFunction name="validateQuoteDate" action="{!validateQuoteDate}"
                                 reRender="surchargeType,theMiscSection,thePageBlock,theSLMiscTable"
                                 immediate="false" status="loadingstatus">
            </apex:actionFunction>

            <apex:actionFunction name="validateSurchargeType" action="{!validateSurchargeType}"
                                 reRender="surchargeType,theMiscSection,thePageBlock,theSLMiscTable"
                                 immediate="false" status="loadingstatus">
                <apex:param value="" name="newFieldValue" />
            </apex:actionFunction>
            
            <apex:actionFunction name="validateServiceCenter" action="{!validateServiceCenter}" reRender="thePageBlock"
                                 immediate="false" status="loadingstatus"/>
            <apex:actionFunction name="validateEstimateJob" action="{!validateEstimateJob}" reRender="thePageBlock" status="loadingstatus"/>
            <apex:pageBlockSection title="General" collapsible="true" id="thePageBlockSection">
                <apex:outputField value="{!salesOrder.Document_Type__c}"/>
                <apex:inputField value="{!salesOrder.OwnerId}" id="theOwner" onChange="changeOwnerCall(this)" rendered="{!open}" />
                <apex:outputField value="{!salesOrder.OwnerId}" rendered="{!!open}" />

                <apex:inputField value="{!salesOrder.Quote_Status__c}" rendered="{!open && salesOrder.Document_Type__c == 'Sales Quote'}"/>
                <apex:outputField value="{!salesOrder.Quote_Status__c}" rendered="{!!open && salesOrder.Document_Type__c == 'Sales Quote'}"/>

                <apex:inputField value="{!salesOrder.Quote_Type__c}" rendered="{!open && salesOrder.Document_Type__c == 'Sales Quote'}"/>
                <apex:outputField value="{!salesOrder.Quote_Type__c}" rendered="{!!open && salesOrder.Document_Type__c == 'Sales Quote'}"/>

                <apex:outputField value="{!salesOrder.Expiration_Date__c}" rendered="{!salesOrder.Document_Type__c == 'Sales Quote' && salesOrder.Quote_Type__c == 'Recurrence'}"/>
                <apex:pageBlockSectionItem rendered="{!open && salesOrder.Document_Type__c == 'Sales Quote'}">
                    <apex:outputLabel >Quote Contact</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                        <div class="requiredBlock"></div>
                        <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;">
                            <c:CustomLookup componentId="theQuoteContact"
                                            styleClass="input-lookup"
                                            style="width: 150px;"
                                            useSOSL="false"
                                            minSearchLength="1"
                                            secondaryDisplayField="LastName"
                                            onchange="validateContactCall(this);"
                                            filterClause="Contact_Type__c INCLUDES (\'Quote\') AND AccountId = \'{!salesOrder.Bill_to_Customer_No__c}\'"

                                            sObjectType="Sales_Order__c"
                                            sObject="{!salesOrder}"
                                            sObjectField="Quote_Contact__c"

                                            SObjectTypeSearch="Contact"
                                            LinkFieldName="Id"
                                            LookupType="Id"
                                            LookupObject="Contact"
                                            FieldSetName="ContactFieldSet"

                                            RunValidation="True"
                                            ValidateFunction="validateFieldInList"

                                            FilterName1="AccountId"
                                            FilterNameValue1="{!salesOrder.Bill_to_Customer_No__c}"
                                            FilterOperation1="AccountId"
                                            FilterOperationValue1="="
                                            FilterType1="AccountId"
                                            FilterTypeValue1="String"

                                            FilterName2="Contact_Type__c"
                                            FilterNameValue2="Quote"
                                            FilterOperation2="Contact_Type__c"
                                            FilterOperationValue2="INCLUDES"
                                            FilterType2="Contact_Type__c"
                                            FilterTypeValue2="Includes"

                                            fltr1="true"
                                            fltr2="true"
                                            fltr3="true"
                                            fltr4="true"
                                            fltr5="true"
                                            fltr6="true"
                                            fltr7="true"
                            />
                        </apex:panelGrid>
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Quote_Contact__c}" rendered="{!NOT(open) && salesOrder.Document_Type__c == 'Sales Quote'}"/>

                <apex:inputField value="{!salesOrder.Order_Description__c}" rendered="{!open}" />
                <apex:outputField value="{!salesOrder.Order_Description__c}" rendered="{!NOT(open)}" />

                <apex:inputField value="{!salesOrder.Billing_Owner__c}" rendered="{!open}" />
                <apex:outputField value="{!salesOrder.Billing_Owner__c}" rendered="{!NOT(open)}" />

                <apex:inputField value="{!salesOrder.Quote_Date__c}" onChange="validateQuoteDateCall(this)" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Quote_Date__c}"  rendered="{!!open}"/>

                                <apex:pageBlockSectionItem >
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Surcharge_Type__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputField value="{!salesOrder.Surcharge_Type__c}" onChange="validateSurchargeTypeCall(this)" id="surchargeType" rendered="{!open && ISBLANK(salesOrder.Contract__r.Surcharge_Type__c) == true}"/>
                            <apex:outputField value="{!salesOrder.Surcharge_Type__c}" rendered="{!NOT(open) || ISBLANK(salesOrder.Contract__r.Surcharge_Type__c) == false}" />
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:pageblockSectionItem rendered="{!newSO}">
                    <apex:outputLabel >Sales Order Type</apex:outputLabel>
                    <apex:outputPanel id="theSOT">
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;">
                                <c:CustomLookup componentId="theSalesOrderType"
                                                styleClass="input-lookup" style="width: 200px" useSOSL="false"
                                                filterClause="Blocked__c<>true"
                                                minSearchLength="2"
                                                secondaryDisplayField="Code__c"
                                                onchange="validateSalesOrderTypeCall(this);"

                                                sObjectType="Sales_Order__c"
                                                sObject="{!salesOrder}"
                                                sObjectField="Sales_Order_Type__c"

                                                LookupObject="Sales_Order_Type__c"
                                                LookupType="Id"
                                                LinkFieldName="Id"
                                                FieldSetName="SalesOrderTypeFieldSet"
                                                RunValidation="True"
                                                ValidateFunction="validateFieldInList"

                                                FilterName1="Blocked__c"
                                                FilterNameValue1="false"
                                                FilterOperation1="Blocked__c"
                                                FilterOperationValue1="="
                                                FilterType1="Blocked__c"
                                                FilterTypeValue1="Boolean"
                
                                                fltr1="true"
                                                fltr2="true"
                                                fltr3="true"
                                                fltr4="true"
                                                fltr5="true"
                                                fltr6="true"
                                                fltr7="true"
                                />
                            </apex:panelGrid>
                        </div>
                    </apex:outputPanel>
                </apex:pageblockSectionItem>
                <apex:outputField value="{!salesOrder.Sales_Order_Type__c}" rendered="{!NOT(newSO)}"/>

                <apex:inputField value="{!salesOrder.Surcharge_Pct__c}" rendered="{!$Profile.Name == 'System Administrator' && open }" />
                <apex:outputField value="{!salesOrder.Surcharge_Pct__c}" rendered="{!$Profile.Name != 'System Administrator' || !open}" />

                <apex:outputField value="{!salesOrder.Document_Status__c}" rendered="{!salesOrder.Document_Type__c == 'Sales Order'}"/>

                <apex:pageBlockSectionItem>
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Order_Type_Description__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <apex:outputField value="{!salesOrder.Order_Type_Description__c}" rendered="{!open}"/>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Order_Type_Description__c}"/>

                <apex:inputField value="{!salesOrder.Payment_Term__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Payment_Term__c}" rendered="{!!open}"/>

                <apex:pageBlockSectionItem rendered="{!newSO}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Service_Center__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputField value="{!salesOrder.Service_Center__c}" onChange="validateServiceCenter()"/>
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Service_Center__c}" rendered="{!NOT(newSO)}"/>

                <apex:outputField value="{!salesOrder.Emergency_Sales_Order__c}"/>

                <apex:outputField value="{!salesOrder.Subsidiary_Company__c}"/>
                <apex:inputField value="{!salesOrder.Inter_Company_Job__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Inter_Company_Job__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Project_Coordinator__c}" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Project_Coordinator__c}" rendered="{!NOT(open)}"/>
                <apex:outputField value="{!SalesOrder.Project_Coordinator__c}" rendered="{!NOT(open)}"/>

                <apex:inputField value="{!salesOrder.Account_Executives__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Account_Executives__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Opportunity__c}" rendered="{!salesOrder.Document_Type__c=='Sales Quote' && open}"/>
                <apex:outputField value="{!salesOrder.Opportunity__c}" rendered="{!salesOrder.Document_Type__c=='Sales Quote' && !open}"/>

                <apex:outputField value="{!salesOrder.Start_Date__c}" rendered="{!salesOrder.Document_Type__c=='Sales Order'}"/>
                <apex:outputField value="{!SalesOrder.End_Date__c}" rendered="{!salesOrder.Document_Type__c=='Sales Order'}"/>
                <apex:inputField value="{!salesOrder.Estimated_Revenue__c}" rendered="{!open && salesOrder.Document_Type__c=='Sales Order'}"/>
                <apex:outputField value="{!salesOrder.Estimated_Revenue__c}" rendered="{!NOT(open)}"/>
                <apex:pageBlockSectionItem rendered="{!open && salesOrder.Document_Type__c=='Sales Order'}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.CMR_Description__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputField value="{!salesOrder.CMR_Description__c}" rendered="{!open}"/>
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.CMR_Description__c}" rendered="{!NOT(open) && salesOrder.Document_Type__c=='Sales Order'}"/>
                <apex:inputField id="payRule" value="{!salesOrder.Pay_Rule__c}"
                                 rendered="{!open}"
                                 onChange="validatePayRuleCall(this)" />
                <apex:outputField value="{!salesOrder.Pay_Rule__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Estimated_Job_Start_Date__c}" rendered="{!open}" onChange="validateEstimateJob()"/>
                <apex:outputField value="{!salesOrder.Estimated_Job_Start_Date__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Include_Weekend__c}" rendered="{!open}" onChange="validateEstimateJob()"/>
                <apex:outputField value="{!salesOrder.Include_Weekend__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Duration__c}" rendered="{!open}" onChange="validateEstimateJob()"/>
                <apex:outputField value="{!salesOrder.Duration__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Include_Holiday__c}" rendered="{!open}" onChange="validateEstimateJob()"/>
                <apex:outputField value="{!salesOrder.Include_Holiday__c}" rendered="{!NOT(open)}"/>
                <apex:outputField value="{!salesOrder.Estimated_Job_End_Date__c}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Billing and Shipping Address" id="billingInfo" collapsible="true">
                <apex:pageBlockSectionItem rendered="{!theUser.Super_User__c == false || newSO || !open}">
                    <apex:outputLabel >Bill-to Customer</apex:outputLabel>
                    <apex:outputField value="{!salesOrder.Bill_to_Customer_No__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!theUser.Super_User__c == true && !newSO && open}">
                    <apex:outputLabel >Bill-to Customer</apex:outputLabel>
                    <apex:inputField value="{!salesOrder.Bill_to_Customer_No__c}" onChange="validateBillToCustomer()"/>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Phone_No__c}"/>
                <apex:pageBlockSectionItem rendered="{!open}" >
                    <apex:outputLabel >Bill To Contact</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                        <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;">
                            <c:CustomLookup componentId="theBTContact"
                                            styleClass="input-lookup"
                                            style="width: 150px; height:18px;"
                                            useSOSL="false"
                                            minSearchLength="1"
                                            secondaryDisplayField="LastName"
                                            onchange="validateContactCall(this);"
                                            filterClause="Contact_Type__c INCLUDES (\'Billing\') AND AccountId = \'{!salesOrder.Bill_to_Customer_No__c}\'"

                                            sObjectType="Sales_Order__c"
                                            sObject="{!salesOrder}"
                                            sObjectField="Bill_to_Contact__c"

                                            LookupObject="Contact"
                                            LinkFieldName="Id"
                                            LookupType="Id"
                                            FieldSetName="ContactFieldSet"
                                            RunValidation="True"
                                            ValidateFunction="validateFieldInList"

                                            FilterName1="AccountId"
                                            FilterNameValue1="{!salesOrder.Bill_to_Customer_No__c}"
                                            FilterOperation1="AccountId"
                                            FilterOperationValue1="="
                                            FilterType1="AccountId"
                                            FilterTypeValue1="String"

                                            FilterName2="Contact_Type__c"
                                            FilterNameValue2="Billing"
                                            FilterOperation2="Contact_Type__c"
                                            FilterOperationValue2="INCLUDES"
                                            FilterType2="Contact_Type__c"
                                            FilterTypeValue2="Includes"

                                            fltr1="true"
                                            fltr2="true"
                                            fltr3="true"
                                            fltr4="true"
                                            fltr5="true"
                                            fltr6="true"
                                                fltr7="true"/>
                        </apex:panelGrid>
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Bill_to_Contact__c}" rendered="{!!open}" />
                <apex:pageBlockSectionItem />
                <apex:outputField value="{!SalesOrder.Street__c}"/>
                <apex:outputField value="{!salesOrder.Phone_Ext__c}"/>
                <apex:outputField value="{!SalesOrder.City__c}"/>
                <apex:outputField value="{!salesOrder.Fax_No__c}"/>
                <apex:outputField value="{!SalesOrder.State__c}"/>
                <apex:pageBlockSectionItem rendered="{!open}">
                    <apex:outputLabel >Contract</apex:outputLabel>
                    <apex:outputpanel >
                        <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;">
                            <c:CustomLookup componentId="theContract"
                                            styleClass="input-lookup"
                                            style="width: 150px; height:18px;"
                                            useSOSL="false"
                                            minSearchLength="1"
                                            secondaryDisplayField="Name"
                                            sObjectType="Contract"
                                            sObject="{!theContract}"
                                            sObjectField="ContractNumber"
                                            SObjectTypeSearch="Name"
                                            onchange="validateContractCall(this);"

                                            allowtoBlank="true"
                                            LookupObject="Contract"
                                            LinkFieldName="Id"
                                            FieldSetName="ContractFieldSet"
                                            RunValidation="True"
                                            LookupType="Id"
                                            ValidateFunction="validateContractCall"

                                            FilterName1Special="AccountId"
                                            FilterNameValue1Special="{!salesOrder.Bill_to_Customer_No__c+','+salesOrder.Bill_to_Customer_No__r.ParentId}"
                                            FilterOperation1Special="AccountId"
                                            FilterOperationValue1Special="="
                                            FilterType1Special="AccountId"
                                            FilterTypeValue1Special="string"

                                            calledFrom="SalesOrder"
                                            calledFor="ContractLookUp"
                                            isSpecialScenario="true"

                                            fltr1="true"
                                            fltr2="true"
                                            fltr3="true"
                                            fltr4="true"
                                            fltr5="true"
                                            fltr6="true"
                                            fltr7="true"
                            />
                        </apex:panelGrid>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Contract__c}" rendered="{!!open}"/>

                <apex:outputField value="{!salesOrder.Country__c}"/>
                <apex:outputField value="{!salesOrder.Contract_Name__c}" />
                <apex:inputField value="{!salesOrder.From_Sales_Quote__c}" rendered="{!salesOrder.Document_Type__c=='Sales Order'}"/>
                <apex:outputField value="{!salesOrder.From_Sales_Quote__c}" rendered="{!NOT(open) || salesOrder.Document_Type__c == 'Sales Quote'}"/>
                
                <apex:pageBlockSectionItem rendered="{!open}">
                    <apex:outputLabel >Rate Sheet</apex:outputLabel>
                    <apex:outputpanel >
                        <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;">
                            <c:CustomLookup componentId="theRateSheet"
                                            styleClass="input-lookup"
                                            style="width: 150px; height:18px;"
                                            useSOSL="false"
                                            minSearchLength="1"
                                            secondaryDisplayField="Name"
                                            sObjectType="Sales_Order__c"
                                            sObject="{!salesOrder}"
                                            sObjectField="Rate_Sheet__c"
                                            onchange="validateRateSheetCall(this);"

                                            allowtoBlank="true"
                                            LookupObject="Rate_Sheet__c"
                                            LinkFieldName="Id"
                                            FieldSetName="RateSheetFieldSet"
                                            RunValidation="True"
                                            LookupType="Id"
                                            ValidateFunction="validateRateSheetCall"

                                            fltr1="true"
                                            fltr2="true"
                                            fltr3="true"
                                            fltr4="true"
                                            fltr5="true"
                                            fltr6="true"
                                            fltr7="true"
                            />
                        </apex:panelGrid>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Rate_Sheet__c}" rendered="{!!open}"/>

                <apex:inputField value="{!SalesOrder.Customer_PO_No__c}" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Customer_PO_No__c}" rendered="{!NOT(open)}"/>

            </apex:pageBlockSection>
            <apex:pageBlockSection title="Site Information" collapsible="true" id="siteInfo">
                <apex:inputField value="{!salesOrder.Alternate_Site_Address__c}" onchange="validateAltSiteAddress(this)" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Alternate_Site_Address__c}" rendered="{!NOT(open)}"/>
                <apex:inputField label="Site Contact" value="{!salesOrder.Site_Contact__c}" rendered="{!open}"/>
                <apex:outputField label="Site Contact" value="{!salesOrder.Site_Contact__c}" rendered="{!NOT(open)}"/>
                
                <apex:pageBlockSectionItem rendered="{!open}">
                    <apex:outputLabel >Site Contact</apex:outputLabel>
                    <apex:outputpanel >
                        <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;">
                            <c:CustomLookup componentId="theSiteContact"
                                            styleClass="input-lookup"
                                            style="width: 150px; height:18px;"
                                            useSOSL="false"
                                            minSearchLength="1"
                                            secondaryDisplayField="LastName"
                                            onchange="validateContactCall(this);"
                                            filterClause="Contact_Type__c INCLUDES (\'Site\') AND AccountId = \'{!salesOrder.Bill_to_Customer_No__c}\'"

                                            sObjectType="Sales_Order__c"
                                            sObject="{!salesOrder}"
                                            sObjectField="Site_Contact_2__c"

                                            LookupObject="Contact"
                                            LinkFieldName="Id"
                                            LookupType="Id"
                                            FieldSetName="ContactFieldSet"
                                            RunValidation="True"
                                            ValidateFunction="validateFieldInList"

                                            FilterName1="AccountId"
                                            FilterNameValue1="{!salesOrder.Bill_to_Customer_No__c}"
                                            FilterOperation1="AccountId"
                                            FilterOperationValue1="="
                                            FilterType1="AccountId"
                                            FilterTypeValue1="String"

                                            FilterName2="Contact_Type__c"
                                            FilterNameValue2="Site"
                                            FilterOperation2="Contact_Type__c"
                                            FilterOperationValue2="INCLUDES"
                                            FilterType2="Contact_Type__c"
                                            FilterTypeValue2="Includes"

                                            fltr1="true"
                                            fltr2="true"
                                            fltr3="true"
                                            fltr4="true"
                                            fltr5="true"
                                            fltr6="true"
                                            fltr7="true"
                            />
                        </apex:panelGrid>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!salesOrder.Site_Contact_2__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Site_Name__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Site_Name__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Site_Phone_No__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Site_Phone_No__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!SalesOrder.Site_Street__c}" id="siteStreet" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Site_Street__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Site_Email_Address__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Site_Email_Address__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!SalesOrder.Site_City__c}" id="siteCity" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Site_City__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Mobile_Email__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Mobile_Email__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!SalesOrder.Site_State__c}" id="siteState" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Site_State__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!salesOrder.Create_Site_Address__c}" rendered="{!open}"/>
                <apex:outputField value="{!salesOrder.Create_Site_Address__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!SalesOrder.Site_Postal_Code__c}" id="sitePostalCode" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Site_Postal_Code__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!SalesOrder.Print_Site_Name__c}" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Print_Site_Name__c}" rendered="{!NOT(open)}"/>
                <apex:inputField value="{!SalesOrder.Site_Country__c}" id="siteCountry" rendered="{!open}"/>
                <apex:outputField value="{!SalesOrder.Site_Country__c}" rendered="{!NOT(open)}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Tax_Liable__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <apex:inputField value="{!salesOrder.Tax_Liable__c}" rendered="{!open}" onchange="validateTaxLiable(this);"/>
                        <apex:outputField value="{!salesOrder.Tax_Liable__c}" rendered="{!NOT(open)}"/>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem id="ta" rendered="{!open}">
                    <apex:outputLabel >Tax Area</apex:outputLabel>
                    <apex:outputPanel id="theTA">                                                     
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                        <apex:panelGrid columns="3" cellspacing="1" style="margin-left:00px;" id="LPNL">
                            <c:CustomLookup componentId="{!$Component.theTable}:theTaxArea"
                                            styleClass="input-lookup" style="width: 200px" useSOSL="false"
                                            minSearchLength="1"
                                            filterClause="Blocked__c <> true"
                                sObjectType="Sales_Order__c"
                                sObject="{!salesOrder}"
                                sObjectField="Tax_Area__c"

                                LookupObject="Tax_Area__c"
                                LinkFieldName="Id"
                                            secondaryDisplayField="Description__c"
                                FieldSetName="TaxAreaFieldSet"
                                            onchange="validateFieldInList(this);"
                                            RunValidation="True"
                                            LookupType="Id"
                                            
                                            ValidateFunction="validateFieldInList"
                                            
                                                FilterName1="Blocked__c"
                                                FilterNameValue1="false"
                                                FilterOperation1="Blocked__c"
                                                FilterOperationValue1="="
                                                FilterType1="Blocked__c"
                                                FilterTypeValue1="Boolean"

                                            fltr1="true"
                                            fltr2="true"
                                            fltr3="true"
                                            fltr4="true"
                                            fltr5="true"
                                            fltr6="true"
                                            fltr7="true"
                                            />
                        </apex:panelGrid>
                        </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(open)}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Tax_Area__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:outputField value="{!salesOrder.Tax_Area__c}" rendered="{!NOT(open)}"/>
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Instructions" collapsible="true">
                <apex:pageBlockSectionItem rendered="{!open}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Site_Scope__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputField value="{!salesOrder.Site_Scope__c}" style="width:100%; height: 60px"/>
                        </div>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(open)}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Site_Scope__c.Label}</apex:outputLabel>
                    <apex:outputField value="{!salesOrder.Site_Scope__c}" style="width:100%; height: 60px"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />

                <apex:pageBlockSectionItem rendered="{!open}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Billing_Instructions__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                            <apex:inputField value="{!salesOrder.Billing_Instructions__c}" style="width:100%; height: 60px"/>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(open)}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Billing_Instructions__c.Label}</apex:outputLabel>
                    <apex:outputField value="{!salesOrder.Billing_Instructions__c}" style="width:100%; height: 60px"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />

                <apex:pageBlockSectionItem rendered="{!open}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Internal_Comments__c.Label}</apex:outputLabel>
                    <apex:outputpanel >
                            <apex:inputField value="{!salesOrder.Internal_Comments__c}" style="width:100%; height: 60px"/>
                    </apex:outputpanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!NOT(open)}">
                    <apex:outputLabel >{!$ObjectType.Sales_Order__c.Fields.Internal_Comments__c.Label}</apex:outputLabel>
                    <apex:outputField value="{!salesOrder.Internal_Comments__c}" style="width:100%; height: 60px"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
            </apex:pageBlockSection>

            <apex:actionRegion >
                <apex:actionFunction name="validateField" action="{!validateField}" oncomplete="setFocusOnLoad();setWidth();"
                                     reRender="SLTotal,SLLaborTotal,SLEquipmentTotal,SLMaterialsTotal,SLSubcontractorsTotal,
                                                SLWasteDisposalTotal,SLLumpSumTotal,SLMiscTotal,SLDemurrageTotal,theLaborSection,
                                                theMaterialsSection,theEquipmentSection,theSubcontractorsSection,
                                                theWasteDisposalSection,theLumpSumSection,theDemurrageSection,theMiscSection,
                                                theMessage,theMessage2,thePageBlockSection"
                                     immediate="false" status="loadingstatus">
                    <apex:param value="" name="fieldName"/>
                    <apex:param value="" name="newFieldValue"/>
                    <apex:param value="" name="lineNo"/>
                </apex:actionFunction>
                <apex:pageMessages id="theMessage2" escape="false"></apex:pageMessages>

                <apex:pageBlockSection id="theLaborSection" columns="1" title="Labor Lines" collapsible="true">
                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable value="{!SOListLaborLines}" var="line" id="theLaborLineTable"
                                             rendered="{!NOT(ISNULL(SOListLaborLines))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" disabled="{!NOT(open)}"
                                                    onclick="if(!confirmDelete()){return false};" action="{!deleteLine}"
                                                    reRender="theLaborLineTable" status="loadingstatus">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Labor"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="Labor Type">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theLaborLineTable}:theJobPositionINPT"
                                                        styleClass="input-lookup"
                                                        style="width: 150px"
                                                        filterClause="Blocked__c=false AND Category__c = \'Labor\'"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Resource_Type__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Resource_Type__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="ResourceTypeFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateFieldPlus"

                                                        FilterName1="Category__c"
                                                        FilterNameValue1="Labor"
                                                        FilterOperation1="Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Blocked__c"
                                                        FilterNameValue2="false"
                                                        FilterOperation2="Blocked__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Blocked__c"
                                                        FilterTypeValue2="Boolean"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"/>

                                    </div>
                                </apex:outputpanel>
                                <apex:outputField id="theItem" rendered="{!NOT(open)}" value="{!line.Resource_Type__c}"/>
                            </apex:column>
                            <apex:column headerValue="Days Needed">
                                <apex:inputField id="laborDaysNeeded" value="{!line.Number_of_Day__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this);"
                                                 styleClass="input-numeric"/>
                                <apex:outputText value="{0, number, ###,##0}"
                                                 rendered="{!NOT(open)}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Number_of_Day__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Quantity__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <apex:inputField id="theLQuantity" value="{!line.Quantity__c}"
                                                         onchange="validateFieldInList(this);"
                                                         styleClass="input-numeric"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputPanel rendered="{!NOT(open)}">{!line.Quantity__c}</apex:outputPanel>
                            </apex:column>
                            <apex:column headerValue="Billing Description">
                                <apex:inputField id="theDescription" value="{!line.Description__c}" rendered="{!open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!!open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.UOM_Qty__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <apex:inputField id="theLUOMQuantity" value="{!line.UOM_Qty__c}"
                                                         onchange="validateFieldInList(this);"
                                                         styleClass="input-numeric"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputPanel rendered="{!NOT(open)}">{!line.UOM_Qty__c}</apex:outputPanel>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theLaborLineTable}:theLLUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"
                                                        
                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        FilterName1Special="ResourceType"
                                                        FilterNameValue1Special="{!line.Resource_Type__c}"
                                                        FilterOperation1Special="ResourceType"
                                                        FilterOperationValue1Special="="
                                                        FilterType1Special="ResourceType"
                                                        FilterTypeValue1Special="string"
                                                        
                                                        calledFrom="SalesOrder"
                                                        calledFor="ResourceTypeUOMLookup"
                                                        isSpecialScenario="true"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!!open}"/>
                            </apex:column>


                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Regular_Rate__c.Label}">
                                <apex:inputField id="theRegularRate" value="{!line.Regular_Rate__c}"
                                                 rendered="{!open}"
                                                 style="width:60px" onchange="validateFieldInList(this)"
                                                 styleClass="UnitPrice input-numeric"/>

                                <apex:outputField value="{!line.Regular_Rate__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Overtime_Rate__c.Label}">
                                <apex:inputField id="theOvertimeRate" value="{!line.Overtime_Rate__c}"
                                                 rendered="{!open}"
                                                 style="width:60px" onchange="validateFieldInList(this)"
                                                 styleClass="UnitPrice input-numeric"/>
                                <apex:outputField value="{!line.Overtime_Rate__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Premium_Rate__c.Label}">
                                <apex:inputField id="thePremiumRate" value="{!line.Premium_Rate__c}"
                                                 rendered="{!open}"
                                                 style="width:60px" onchange="validateFieldInList(this)"
                                                 styleClass="UnitPrice input-numeric"/>
                                <apex:outputField rendered="{!!open}" value="{!line.Premium_Rate__c}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Regular_Rate__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">
                                <apex:outputField value="{!line.Contract_Regular_Rate__c}"/>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Regular_Hours__c.Label}">
                                <apex:inputField id="theRegularHours" style="width:60px" onchange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Regular_Hours__c}"/>
                                <apex:outputField value="{!line.Regular_Hours__c}" rendered="{!!open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Overtime_Hours__c.Label}">
                                <apex:inputField id="theOvertimeHours" style="width:60px" onchange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Overtime_Hours__c}"/>
                                <apex:outputField value="{!line.Overtime_Hours__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Premium_Hours__c.Label}">
                                <apex:inputField id="thePremiumHours" style="width:60px" onchange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Premium_Hours__c}"/>
                                <apex:outputField value="{!line.Premium_Hours__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theLBillasLumpSum" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Bill_as_Lump_Sum__c}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theLNonBillable" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Non_Billable__c}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!!open}" />
                            </apex:column>


                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theLTaxGroup" value="{!line.Tax_Group__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="input-description"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Line__c.Label}"
                                rendered="{!salesOrder.Contract__c != null}">

                                <apex:outputpanel rendered="{!open}">
                                    <c:CustomLookup componentId="{!$Component.theLaborLineTable}:theLContractLine"
                                                    styleClass="input-lookup"
                                                    style="width: 100px"
                                                    secondaryDisplayField="Name"
                                                    minSearchLength="1"
                                                    stealFocus="true"
                                                    sObjectType="Sales_Line__c"
                                                    sObject="{!line}"
                                                    sObjectField="Contract_Line__c"
                                                    onchange="validateFieldInList(this);"
                                                    
                                                    allowtoBlank="true"
                                                    LookupObject="Contract_Line__c"
                                                    LinkFieldName="Name"
                                                    FieldSetName="CLFieldSet"
                                                    RunValidation="True"
                                                    LookupType="ID"
                                                    ValidateFunction="validateField"
                                                    
                                                    FilterName1="Resource_Type_Category__c"
                                                    FilterNameValue1="Labor"
                                                    FilterOperation1="Resource_Type_Category__c"
                                                    FilterOperationValue1="="
                                                    FilterType1="Resource_Type_Category__c"
                                                    FilterTypeValue1="String"
                                                    
                                                    FilterName2="Resource_Type__c"
                                                    FilterNameValue2="{!line.Resource_Type__c}"
                                                    FilterOperation2="Resource_Type__c"
                                                    FilterOperationValue2="="
                                                    FilterType2="Resource_Type__c"
                                                    FilterTypeValue2="String"

                                                    FilterName3="Contract__c"
                                                    FilterNameValue3="{!salesOrder.Contract__c}"
                                                    FilterOperation3="Contract__c"
                                                    FilterOperationValue3="="
                                                    FilterType3="Contract__c"
                                                    FilterTypeValue3="String"

                                                    />
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Contract_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" rendered="{!open}" value="{!line.Quote_Line__c}" style="width: 100px"/>
                                <apex:outputField rendered="{!!open}" value="{!line.Quote_Line__c}" style="width: 100px"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputText id="theLUnitCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Unit_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theLLineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>                            
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_No__c.Label}">
                                <apex:outputPanel >{!line.Line_No__c}</apex:outputPanel>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}"
                                        reRender="theLaborLineTable">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Labor"/>
                    </apex:commandButton>

                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLLaborTotal" columns="5">
                            <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalLabor}"/>
                        </apex:outputText>
                            <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                                <apex:param value="{!SLProfitMarginLabor}"/>
                            </apex:outputText>
                            <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                                <apex:param value="{!SLTotalCostLabor}"/>
                            </apex:outputText>
                            <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalLabor}"/>
                        </apex:outputText>
                            <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalLabor}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <apex:pageBlockSection id="theEquipmentSection" columns="1" title="Equipment Lines" collapsible="true">
                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable value="{!SOListEquipmentLines}" var="line" id="theEquipmentLineTable"
                                             rendered="{!NOT(ISNULL(SOListEquipmentLines))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" disabled="{!NOT(open)}"
                                                    onclick="if(!confirmDelete()){return false};" action="{!deleteLine}"
                                                    reRender="theEquipmentLineTable">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Equipment"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="Equipment Type">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theEquipmentLineTable}:theEquipmentINPT"
                                                styleClass="input-lookup"
                                                style="width: 150px"
                                                filterClause="Blocked__c=false AND Category__c=\'Equipment\'"
                                                secondaryDisplayField="Description__c"
                                                minSearchLength="1"
                                                stealFocus="true"
                                                sObjectType="Sales_Line__c"
                                                sObject="{!line}"
                                                sObjectField="Resource_Type__c"
                                                onchange="validateFieldInList(this);"

                                                allowtoBlank="true"
                                                LookupObject="Resource_Type__c"
                                                LinkFieldName="Name"
                                                FieldSetName="ResourceTypeFieldSet"
                                                RunValidation="True"
                                                LookupType="ID"
                                                ValidateFunction="validateFieldPlus"

                                                FilterName1="Category__c"
                                                FilterNameValue1="Equipment"
                                                FilterOperation1="Category__c"
                                                FilterOperationValue1="="
                                                FilterType1="Category__c"
                                                FilterTypeValue1="String"

                                                FilterName2="Blocked__c"
                                                FilterNameValue2="false"
                                                FilterOperation2="Blocked__c"
                                                FilterOperationValue2="="
                                                FilterType2="Blocked__c"
                                                FilterTypeValue2="Boolean"

                                                fltr1="true"
                                                fltr2="true"
                                                fltr3="true"
                                                fltr4="true"
                                                fltr5="true"
                                                fltr6="true"
                                                fltr7="true"/>

                                    </div>
                                </apex:outputpanel>
                                <apex:outputField id="theItem" rendered="{!NOT(open)}"
                                                  value="{!line.Resource_Type__c}" />
                            </apex:column>

                            <apex:column headerValue="Days Needed">
                                <apex:inputField id="equipmentDaysNeeded" value="{!line.Number_of_Day__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this);"
                                                 styleClass="input-numeric"/>
                                <apex:outputText value="{0, number, ###,##0}"
                                                 rendered="{!NOT(open)}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Number_of_Day__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Quantity__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <apex:inputField id="theEQuantity" value="{!line.Quantity__c}"
                                                         onchange="validateFieldInList(this);"
                                                         styleClass="input-numeric"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputPanel rendered="{!NOT(open)}">{!line.Quantity__c}</apex:outputPanel>
                            </apex:column>
                            <apex:column headerValue="Billing Description">
                                <apex:inputField id="theDescription" value="{!line.Description__c}" rendered="{!open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!!open}"/>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.UOM_Qty__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <apex:inputField id="theEUOMQuantity" value="{!line.UOM_Qty__c}"
                                                         onchange="validateFieldInList(this);"
                                                         styleClass="input-numeric"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputPanel rendered="{!NOT(open)}">{!line.UOM_Qty__c}</apex:outputPanel>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theEquipmentLineTable}:theELUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"
                                                        
                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        FilterName1Special="ResourceType"
                                                        FilterNameValue1Special="{!line.Resource_Type__c}"
                                                        FilterOperation1Special="ResourceType"
                                                        FilterOperationValue1Special="="
                                                        FilterType1Special="ResourceType"
                                                        FilterTypeValue1Special="string"
                                                        
                                                        calledFrom="SalesOrder"
                                                        calledFor="ResourceTypeUOMLookup"
                                                        isSpecialScenario="true"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                                        />
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theEBillasLumpSum" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Bill_as_Lump_Sum__c}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theENonBillable" onChange="validateFieldInList(this)"
                                                 value="{!line.Non_Billable__c}" rendered="{!open}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theEUnitPrice" value="{!line.Unit_Price__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="UnitPrice input-numeric"/>
                                <apex:outputField value="{!line.Unit_Price__c}" rendered="{!!open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Regular_Rate__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">
                                <apex:outputField value="{!line.Contract_Regular_Rate__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theETaxGroup" value="{!line.Tax_Group__c}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 rendered="{!open}"
                                                 styleClass="input-description"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Line__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">

                                <apex:outputpanel rendered="{!open}">
                                    <c:CustomLookup componentId="{!$Component.theEquipmentLineTable}:theEContractLine"
                                                    styleClass="input-lookup"
                                                    style="width: 100px"
                                                    secondaryDisplayField="Name"
                                                    minSearchLength="1"
                                                    stealFocus="true"
                                                    sObjectType="Sales_Line__c"
                                                    sObject="{!line}"
                                                    sObjectField="Contract_Line__c"
                                                    onchange="validateFieldInList(this);"
                                                    
                                                    allowtoBlank="true"
                                                    LookupObject="Contract_Line__c"
                                                    LinkFieldName="Name"
                                                    FieldSetName="CLFieldSet"
                                                    RunValidation="True"
                                                    LookupType="ID"
                                                    ValidateFunction="validateField"
                                                    
                                                    FilterName1="Resource_Type_Category__c"
                                                    FilterNameValue1="Equipment"
                                                    FilterOperation1="Resource_Type_Category__c"
                                                    FilterOperationValue1="="
                                                    FilterType1="Resource_Type_Category__c"
                                                    FilterTypeValue1="String"
                                                    
                                                    FilterName2="Resource_Type__c"
                                                    FilterNameValue2="{!line.Resource_Type__c}"
                                                    FilterOperation2="Resource_Type__c"
                                                    FilterOperationValue2="="
                                                    FilterType2="Resource_Type__c"
                                                    FilterTypeValue2="String"

                                                    FilterName3="Contract__c"
                                                    FilterNameValue3="{!salesOrder.Contract__c}"
                                                    FilterOperation3="Contract__c"
                                                    FilterOperationValue3="="
                                                    FilterType3="Contract__c"
                                                    FilterTypeValue3="String"
                                                    />
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Contract_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" value="{!line.Quote_Line__c}" style="width: 100px" rendered="{!open}"/>
                                <apex:outputField value="{!line.Quote_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputText id="theEUnitCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Unit_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theELineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column> 
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_No__c.Label}">

                                <apex:outputPanel >{!line.Line_No__c}</apex:outputPanel>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}"
                                        reRender="theEquipmentLineTable">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Equipment"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLEquipmentTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalEquipment}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginEquipment}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostEquipment}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalEquipment}"/>
                        </apex:outputText>
                        <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalEquipment}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <apex:pageBlockSection id="theMaterialsSection" columns="1" title="Materials Lines" collapsible="true">
                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable value="{!SOListMaterialLines}" var="line" id="theMaterialsLineTable"
                                             rendered="{!NOT(ISNULL(SOListMaterialLines))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" disabled="{!NOT(open)}"
                                                    onclick="if(!confirmDelete()){return false};" action="{!deleteLine}"
                                                    reRender="theMaterialsLineTable">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Materials"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="Material">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theMaterialsLineTable}:theMaterialINPT"
                                                styleClass="input-lookup"
                                                style="width: 150px"
                                                filterClause="Blocked__c=false AND Category__c = \'Materials\'"
                                                secondaryDisplayField="Description__c"
                                                minSearchLength="1"
                                                stealFocus="true"
                                                sObjectType="Sales_Line__c"
                                                sObject="{!line}"
                                                sObjectField="Resource__c"
                                                onchange="validateFieldInList(this);"

                                                allowtoBlank="true"
                                                LookupObject="Resource__c"
                                                LinkFieldName="Name"
                                                FieldSetName="ResourceFieldSet"
                                                RunValidation="True"
                                                LookupType="ID"
                                                ValidateFunction="validateFieldPlus"

                                                FilterName1="Category__c"
                                                FilterNameValue1="Materials"
                                                FilterOperation1="Category__c"
                                                FilterOperationValue1="="
                                                FilterType1="Category__c"
                                                FilterTypeValue1="String"

                                                FilterName2="Blocked__c"
                                                FilterNameValue2="false"
                                                FilterOperation2="Blocked__c"
                                                FilterOperationValue2="="
                                                FilterType2="Blocked__c"
                                                FilterTypeValue2="Boolean"

                                                fltr1="true"
                                                fltr2="true"
                                                fltr3="true"
                                                fltr4="true"
                                                fltr5="true"
                                                fltr6="true"
                                                fltr7="true"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField id="theItem" rendered="{!NOT(open)}"
                                                  value="{!line.Resource__c}"></apex:outputField>
                            </apex:column>
                            <apex:column headerValue="Billing Description">
                                <apex:inputField id="theDescription" value="{!line.Description__c}" rendered="{!open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!!open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Quantity__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <apex:inputField id="theMQuantity" value="{!line.Quantity__c}"
                                                         onchange="validateFieldInList(this);"
                                                         styleClass="input-numeric"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputPanel rendered="{!NOT(open)}">{!line.Quantity__c}</apex:outputPanel>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theMaterialsLineTable}:theMLUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"
                                                        
                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        FilterName1Special="Resource"
                                                        FilterNameValue1Special="{!line.Resource__c}"
                                                        FilterOperation1Special="Resource"
                                                        FilterOperationValue1Special="="
                                                        FilterType1Special="Resource"
                                                        FilterTypeValue1Special="string"
                                                        
                                                        calledFrom="SalesOrder"
                                                        calledFor="ResourceUOMLookup"
                                                        isSpecialScenario="true"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                                        
                                                        />
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!!open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theMUnitPrice" value="{!line.Unit_Price__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="UnitPrice input-numeric"/>
                                <apex:outputField value="{!line.Unit_Price__c}" rendered="{!!open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Regular_Rate__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">
                                <apex:outputField value="{!line.Contract_Regular_Rate__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theMTaxGroup" value="{!line.Tax_Group__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="input-description"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theMBillasLumpSum" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Bill_as_Lump_Sum__c}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theMNonBillable" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Non_Billable__c}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Line__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">
                                <apex:outputpanel rendered="{!open}">
                                <c:CustomLookup componentId="{!$Component.theMaterialsLineTable}:theMContractLine"
                                                styleClass="input-lookup"
                                                style="width: 100px"
                                                secondaryDisplayField="Name"
                                                minSearchLength="1"
                                                stealFocus="true"
                                                sObjectType="Sales_Line__c"
                                                sObject="{!line}"
                                                sObjectField="Contract_Line__c"
                                                onchange="validateFieldInList(this);"
                                                
                                                allowtoBlank="true"
                                                LookupObject="Contract_Line__c"
                                                LinkFieldName="Name"
                                                FieldSetName="CLFieldSet"
                                                RunValidation="True"
                                                LookupType="ID"
                                                ValidateFunction="validateField"
                                                
                                                FilterName1="Resource_Category__c"
                                                FilterNameValue1="Materials"
                                                FilterOperation1="Resource_Category__c"
                                                FilterOperationValue1="="
                                                FilterType1="Resource_Category__c"
                                                FilterTypeValue1="String"

                                                FilterName2="Resource__c"
                                                FilterNameValue2="{!line.Resource__c}"
                                                FilterOperation2="Resource__c"
                                                FilterOperationValue2="="
                                                FilterType2="Resource__c"
                                                FilterTypeValue2="String"

                                                FilterName3="Contract__c"
                                                FilterNameValue3="{!salesOrder.Contract__c}"
                                                FilterOperation3="Contract__c"
                                                FilterOperationValue3="="
                                                FilterType3="Contract__c"
                                                    FilterTypeValue3="String"/>
                            </apex:outputpanel>
                                <apex:outputField value="{!line.Contract_Line__c}" rendered="{!!open}" />
                        </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" value="{!line.Quote_Line__c}" style="width: 100px" rendered="{!open}"/>
                                <apex:outputField value="{!line.Quote_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputText id="theMUnitCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Unit_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theMLineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column> 
                            
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_No__c.Label}">
                                <apex:outputPanel >{!line.Line_No__c}</apex:outputPanel>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}"
                                        reRender="theMaterialsLineTable">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Materials"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLMaterialsTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalMaterials}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginMaterials}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostMaterials}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalMaterials}"/>
                        </apex:outputText>
                        <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalMaterials}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <apex:pageBlockSection id="theSubcontractorsSection" columns="1" title="Cost Plus Materials, Equipment, and Services"
                                       collapsible="true">
                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable id="theSubcontractorsTable" value="{!SOListSubContractorLines}" var="line"
                                             rendered="{!NOT(ISNULL(SOListSubContractorLines))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" disabled="{!NOT(open)}" onclick="if(!confirmDelete()){return false};"
                                                    action="{!deleteLine}" reRender="theSubcontractorsTable">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Subcontractors"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Description__c.Label}">
                                <apex:inputField id="theDescription" value="{!line.Description__c}" rendered="{!open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!NOT(open)}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Quantity__c.Label}">
                                <apex:inputField id="theSQuantity" value="{!line.Quantity__c}" onChange="validateFieldInList(this)" rendered="{!open}"/>
                                <apex:outputField value="{!line.Quantity__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theSUnitPrice" value="{!line.Unit_Price__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="UnitPrice input-numeric"/>
                                <apex:outputField value="{!line.Unit_Price__c}" rendered="{!!open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Markup_Option__c.Label}">
                                <apex:inputField id="theSMarkupOption" value="{!line.Markup_Option__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this);"/>
                                <apex:outputField value="{!line.Markup_Option__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Markup__c.Label}">
                                <apex:inputField id="theSMarkup" value="{!line.Markup__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this);"/>
                                <apex:outputField value="{!line.Markup__c}" rendered="{!!open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theSTaxGroup" value="{!line.Tax_Group__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="input-description"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theSBillasLumpSum" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Bill_as_Lump_Sum__c}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theSNonBillable" onChange="validateFieldInList(this)"
                                                 rendered="{!open}"
                                                 value="{!line.Non_Billable__c}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!!open}" />
                            </apex:column>


                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputField value="{!line.Unit_Cost__c}" />

                            </apex:column>


                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" value="{!line.Quote_Line__c}" style="width: 100px" rendered="{!open}"/>
                                <apex:outputField value="{!line.Quote_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theSLineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column> 
                            <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}">
                                <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>

                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}"
                                        reRender="theSubcontractorsTable">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Subcontractors"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLSubcontractorsTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalSubcontractors}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginSubcontractors}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostSubcontractors}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalSubcontractors}"/>
                        </apex:outputText>
                        <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalSubcontractors}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <apex:pageBlockSection id="theWasteDisposalSection" columns="1" title="Waste Disposal Lines"
                                       collapsible="true">
                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable id="theTMLWasteDisposalTable" value="{!SOListWasteDisposal}" var="line"
                                             rendered="{!NOT(ISNULL(SOListWasteDisposal))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" disabled="{!NOT(open) || line.System_Calculated_Line__c}" onclick="if(!confirmDelete()){return false};"
                                                    action="{!deleteLine}" reRender="theTMLWasteDisposalTable">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Waste Disposal"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="Waste Disposal">
                                <apex:outputpanel rendered="{!line.System_Calculated_Line__c != true && open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theTMLWasteDisposalTable}:theWResource"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        filterClause="Blocked__c=false AND Category__c = \'Waste Disposal\' AND Id <> \'{!theCompanySetup.Default_Manifest_Fee_Resource__c}\'"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Resource__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Resource__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="ResourceFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1="Category__c"
                                                        FilterNameValue1="Waste Disposal"
                                                        FilterOperation1="Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Blocked__c"
                                                        FilterNameValue2="false"
                                                        FilterOperation2="Blocked__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Blocked__c"
                                                        FilterTypeValue2="Boolean"

                                                        FilterName3="Id"
                                                        FilterNameValue3="{!theCompanySetup.Default_Manifest_Fee_Resource__c}"
                                                        FilterOperation3="Id"
                                                        FilterOperationValue3="!="
                                                        FilterType3="Id"
                                                        FilterTypeValue3="String"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Resource__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Description__c.Label}">
                                <apex:inputField id="theDescription" value="{!line.Description__c}" rendered="{!open && NOT(line.System_Calculated_Line__c)}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!NOT(open) || line.System_Calculated_Line__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Quantity__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <apex:inputField id="theWQuantity" value="{!line.Quantity__c}"
                                                         onchange="validateFieldInList(this);"
                                                         styleClass="input-numeric width40"/>
                                    </div>
                                </apex:outputpanel>

                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputpanel rendered="{!line.System_Calculated_Line__c != true && open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theTMLWasteDisposalTable}:theWUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                                        />
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theWUnitPrice" value="{!line.Unit_Price__c}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="UnitPrice input-numeric" rendered="{!NOT(line.System_Calculated_Line__c)}"/>
                                <apex:outputField value="{!line.Unit_Price__c}" rendered="{!line.System_Calculated_Line__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theWTaxGroup" value="{!line.Tax_Group__c}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="input-description" rendered="{!NOT(line.System_Calculated_Line__c)}"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!line.System_Calculated_Line__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" value="{!line.Quote_Line__c}" style="width: 100px" rendered="{!open}"/>
                                <apex:outputField value="{!line.Quote_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputText id="theWUnitCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Unit_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theWLineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column> 
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theWBillasLumpSum" onChange="validateFieldInList(this)"
                                                 rendered="{!!line.System_Calculated_Line__c && open}"
                                                 value="{!line.Bill_as_Lump_Sum__c}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theWNonBillable" onChange="validateFieldInList(this)"
                                                 rendered="{!!line.System_Calculated_Line__c && open}"
                                                 value="{!line.Non_Billable__c}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>

                            <apex:column headerValue="UOM">
                                <apex:outputField value="{!line.Unit_of_Measure__c}" />
                            </apex:column>

                            <apex:column headerValue="Res UOM">
                                <apex:outputField value="{!line.Resource_UOM__c}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}">
                                <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>

                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}"
                                        reRender="theTMLWasteDisposalTable,theMessage">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Waste Disposal"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLWasteDisposalTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalWasteDisposal}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginWasteDisposal}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostWasteDisposal}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalWasteDisposal}"/>
                        </apex:outputText>
                        <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalWasteDisposal}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>


                <apex:pageBlockSection id="theDemurrageSection" columns="1" title="Transportation, Demurrage and Fees" collapsible="true">
                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable id="theSLDemurrageTable" value="{!SOListDemurrage}" var="line" rendered="{!NOT(ISNULL(SOListDemurrage))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" onClick="if(!confirmDelete()){return false};"
                                                    action="{!deleteLine}" reRender="theSLDemurrageTable"
                                                    disabled="{!line.System_Calculated_Line__c || !open}">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Demurrage"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="Service">
                                <apex:outputPanel rendered="{!NOT(line.System_Calculated_Line__c) && open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                            <c:CustomLookup componentId="{!$Component.theSLDemurrageTable}:theDResource"
                                                            styleClass="input-lookup"
                                                            style="width: 150px"
                                                            filterClause="Blocked__c=false AND Category__c = \'Demurrage\'"
                                                            secondaryDisplayField="Description__c"
                                                            minSearchLength="1"
                                                            stealFocus="true"
                                                            sObjectType="Sales_Line__c"
                                                            sObject="{!line}"
                                                            sObjectField="Resource__c"
                                                            onchange="validateFieldInList(this);"

                                                            allowtoBlank="true"
                                                            LookupObject="Resource__c"
                                                            LinkFieldName="Name"
                                                            FieldSetName="ResourceFieldSet"
                                                            RunValidation="True"
                                                            LookupType="ID"
                                                            ValidateFunction="validateField"

                                                            FilterName1="Category__c"
                                                            FilterNameValue1="Demurrage"
                                                            FilterOperation1="Category__c"
                                                            FilterOperationValue1="="
                                                            FilterType1="Category__c"
                                                            FilterTypeValue1="String"

                                                            FilterName2="Blocked__c"
                                                            FilterNameValue2="false"
                                                            FilterOperation2="Blocked__c"
                                                            FilterOperationValue2="="
                                                            FilterType2="Blocked__c"
                                                            FilterTypeValue2="Boolean"

                                                            FilterName3="id"
                                                            FilterNameValue3=""
                                                            FilterOperation3="Blocked__c"
                                                            FilterOperationValue3="NOT IN"
                                                            FilterType3="Blocked__c"
                                                            FilterTypeValue3="Boolean"

                                                            fltr1="true"
                                                            fltr2="true"
                                                            fltr3="true"
                                                            fltr4="true"
                                                            fltr5="true"
                                                            fltr6="true"
                                                            fltr7="true"/>

                                    </div>
                                </apex:outputPanel>
                                <apex:outputField value="{!line.Resource__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Description__c.Label}">
                                <apex:inputField id="theDDescription" value="{!line.Description__c}" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="Quantity">
                                <apex:inputField id="theDQuantity" value="{!line.Quantity__c}"
                                                 onchange="validateFieldInList(this);" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Quantity__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputPanel rendered="{!NOT(line.System_Calculated_Line__c) && open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theSLDemurrageTable}:theDUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1Special="Resource"
                                                        FilterNameValue1Special="{!line.Resource__c}"
                                                        FilterOperation1Special="Resource"
                                                        FilterOperationValue1Special="="
                                                        FilterType1Special="Resource"
                                                        FilterTypeValue1Special="string"

                                                        calledFrom="SalesOrder"
                                                        calledFor="ResourceUOMLookup"
                                                        isSpecialScenario="true"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"/>
                                    </div>
                                </apex:outputPanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theDUnitPrice" value="{!line.Unit_Price__c}"
                                                 onchange="validateFieldInList(this);" style="width:60px"
                                                 styleClass="UnitPrice input-numeric" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Unit_Price__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theDTaxGroup" value="{!line.Tax_Group__c}"
                                                 onchange="validateFieldInList(this);" style="width:60px"
                                                 styleClass="input-description" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theDBillasLumpSum" onChange="validateFieldInList(this)"
                                                 value="{!line.Bill_as_Lump_Sum__c}" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theDNonBillable" onChange="validateFieldInList(this)"
                                                 value="{!line.Non_Billable__c}" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!line.System_Calculated_Line__c || !open}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_No__c.Label}">
                                <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}" reRender="theSLDemurrageTable,theMessage">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Demurrage"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLDemurrageTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalDemurrage}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginDemurrage}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostDemurrage}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalDemurrage}"/>
                        </apex:outputText>
                        <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalDemurrage}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <apex:pageBlockSection id="theLumpSumSection" columns="1" title="Lump Sum/Bundled Lines" collapsible="true">

                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable id="theSLLumpSumTable" value="{!SOListLumpSum}" var="line"
                                             rendered="{!NOT(ISNULL(SOListLumpSum))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" onclick="if(!confirmDelete()){return false};"
                                                    disabled="{!!open}"
                                                    action="{!deleteLine}" reRender="theSLLumpSumTable">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Bundled"/>
                                </apex:commandButton>
                            </apex:column>
                            <apex:column headerValue="Resource Type">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theSLLumpSumTable}:theLumpSumResourceType"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        filterClause="Blocked__c=false  AND Category__c=\'Bundled\'"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Resource_Type__c"
                                                        onchange="validateFieldInList(this);"
                                                        
                                                        allowtoBlank="true"
                                                        LookupObject="Resource_Type__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="ResourceTypeFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        FilterName1="Category__c"
                                                        FilterNameValue1="Bundled"
                                                        FilterOperation1="Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Category__c"
                                                        FilterTypeValue1="String"
                                                        
                                                        FilterName2="Blocked__c"
                                                        FilterNameValue2="false"
                                                        FilterOperation2="Blocked__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Blocked__c"
                                                        FilterTypeValue2="Boolean"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Resource_Type__c}" rendered="{!!open}" />
                            </apex:column>


                            
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Description__c.Label}">
                                <apex:inputField id="theLumpDescription" value="{!line.Description__c}" rendered="{!open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Quantity__c.Label}">
                                <apex:inputField id="theLumpQuantity" value="{!line.Quantity__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)"/>
                                <apex:outputField value="{!line.Quantity__c}" rendered="{!!open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputpanel rendered="{!open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theSLLumpSumTable}:theLumpUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"
                                                        
                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        FilterName1Special="ResourceType"
                                                        FilterNameValue1Special="{!line.Resource_Type__c}"
                                                        FilterOperation1Special="ResourceType"
                                                        FilterOperationValue1Special="="
                                                        FilterType1Special="ResourceType"
                                                        FilterTypeValue1Special="string"
                                                        
                                                        calledFrom="SalesOrder"
                                                        calledFor="ResourceTypeUOMLookup"
                                                        isSpecialScenario="true"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                                        
                                                        />
                                    </div>

                                </apex:outputpanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theLumpUnitPrice" value="{!line.Unit_Price__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="UnitPrice input-numeric"/>
                            <apex:outputField value="{!line.Unit_Price__c}" rendered="{!!open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>


                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Line__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">
                                <apex:outputpanel rendered="{!open}">
                                    <c:CustomLookup componentId="{!$Component.theSLLumpSumTable}:theLumpSumContractLine"
                                                    styleClass="input-lookup"
                                                    style="width: 100px"
                                                    secondaryDisplayField="Name"
                                                    minSearchLength="1"
                                                    stealFocus="true"
                                                    sObjectType="Sales_Line__c"
                                                    sObject="{!line}"
                                                    sObjectField="Contract_Line__c"
                                                    onchange="validateFieldInList(this);"
                                                    
                                                    allowtoBlank="true"
                                                    LookupObject="Contract_Line__c"
                                                    LinkFieldName="Name"
                                                    FieldSetName="CLFieldSet"
                                                    RunValidation="True"
                                                    LookupType="ID"
                                                    ValidateFunction="validateField"
                                                    
                                                    FilterName1="Resource_Type_Category__c"
                                                    FilterNameValue1="Bundled"
                                                    FilterOperation1="Resource_Type_Category__c"
                                                    FilterOperationValue1="="
                                                    FilterType1="Resource_Type_Category__c"
                                                    FilterTypeValue1="String"
                                                    
                                                    FilterName2="Resource_Type__c"
                                                    FilterNameValue2="{!line.Resource_Type__c}"
                                                    FilterOperation2="Resource_Type__c"
                                                    FilterOperationValue2="="
                                                    FilterType2="Resource_Type__c"
                                                    FilterTypeValue2="String"
                                                    
                                                    FilterName3="Contract__c"
                                                    FilterNameValue3="{!salesOrder.Contract__c}"
                                                    FilterOperation3="Contract__c"
                                                    FilterOperationValue3="="
                                                    FilterType3="Contract__c"
                                                    FilterTypeValue3="String"
                                                    
                                                    fltr1="true"
                                                    fltr2="true"
                                                    fltr3="true"
                                                    fltr4="true"
                                                    fltr5="true"
                                                    fltr6="true"
                                                    fltr7="true"
                                                    />
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Contract_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Contract_Regular_Rate__c.Label}"
                                         rendered="{!salesOrder.Contract__c != null}">
                                <apex:outputField id="theContractRegularRate" value="{!line.Contract_Regular_Rate__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theLumpTaxGroup" value="{!line.Tax_Group__c}"
                                                 rendered="{!open}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="input-description"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" value="{!line.Quote_Line__c}" style="width: 100px" rendered="{!open}"/>
                                <apex:outputField value="{!line.Quote_Line__c}" rendered="{!!open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputText id="theLumpUnitCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Unit_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theLumpLineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column> 
                            <apex:column headerValue="{!$ObjectType.TM_Line__c.fields.Line_No__c.Label}">
                                <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" disabled="{!NOT(open)}" action="{!insertLine}" reRender="theSLLumpSumTable,theMessage">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Bundled"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLLumpSumTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalLumpSum}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginLumpSum}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost:{0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostLumpSum}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalLumpSum}"/>
                        </apex:outputText>
                        <apex:outputText value="Toatl: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalLumpSum}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <apex:pageBlockSection id="theMiscSection" columns="1" title="Miscellaneous Fees, Charges and Taxes"
                                       collapsible="true">

                    <apex:outputPanel styleClass="salesLineWrap" layout="block">
                        <apex:pageBlockTable id="theSLMiscTable" value="{!SOListMisc}" var="line"
                                             rendered="{!NOT(ISNULL(SOListMisc))}">
                            <apex:column headerValue="Action" styleClass="actionColumn" style="width:60px">
                                <apex:commandButton value="Delete" onclick="if(!confirmDelete()){return false};"
                                                    action="{!deleteLine}" reRender="theSLMiscTable"
                                                    disabled="{!line.System_Calculated_Line__c || !open}">
                                    <apex:param id="objectType" name="objectType" value="SalesLine"/>
                                    <apex:param id="lineNo" name="lineNo" value="{!line.Line_No__c}"/>
                                    <apex:param id="lineType" name="lineType" value="Misc. Charges And Taxes"/>
                                </apex:commandButton>
                            </apex:column>


                            <apex:column headerValue="Service">
                                <apex:outputpanel rendered="{!NOT(line.System_Calculated_Line__c) && open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theSLMiscTable}:theMiscResource"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        filterClause="Blocked__c=false AND Category__c = \'Misc. Charges And Taxes\' AND Id != \'{!theCompanySetup.Default_Fuel_Surcharge_Resource__c}\' AND Id !=\'{!theCompanySetup.Default_Energy_Insurance_Resource__c}\'"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Resource__c"
                                                        onchange="validateFieldInList(this);"

                                                        allowtoBlank="true"
                                                        LookupObject="Resource__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="ResourceFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"

                                                        FilterName1="Category__c"
                                                        FilterNameValue1="Misc. Charges And Taxes"
                                                        FilterOperation1="Category__c"
                                                        FilterOperationValue1="="
                                                        FilterType1="Category__c"
                                                        FilterTypeValue1="String"

                                                        FilterName2="Blocked__c"
                                                        FilterNameValue2="false"
                                                        FilterOperation2="Blocked__c"
                                                        FilterOperationValue2="="
                                                        FilterType2="Blocked__c"
                                                        FilterTypeValue2="Boolean"

                                                        FilterName3="Id"
                                                        FilterNameValue3="{!theCompanySetup.Default_Energy_Insurance_Resource__c}"
                                                        FilterOperation3="Id"
                                                        FilterOperationValue3="!="
                                                        FilterType3="Id"
                                                        FilterTypeValue3="String"

                                                        FilterName4="Name"
                                                        FilterNameValue4="{!theCompanySetup.Default_Fuel_Surcharge_Resource__r.Name}"
                                                        FilterOperation4="Name"
                                                        FilterOperationValue4="!="
                                                        FilterType4="Name"
                                                        FilterTypeValue4="String"

                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"/>
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Resource__c}" rendered="{!line.System_Calculated_Line__c ||!open}" />
                            </apex:column>


                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Description__c.Label}">
                                <apex:inputField id="theDescription" value="{!line.Description__c}" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Description__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Quantity__c.Label}">
                                <apex:inputField id="theMiscQuantity" value="{!line.Quantity__c}"
                                                 onchange="validateFieldInList(this)" rendered="{!NOT(line.System_Calculated_Line__c) && open}" />
                                <apex:outputField value="{!line.Quantity__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_of_Measure__c.Label}">
                                <apex:outputpanel rendered="{!NOT(line.System_Calculated_Line__c) && open}">
                                    <div class="requiredInput">
                                        <div class="requiredBlock"></div>
                                        <c:CustomLookup componentId="{!$Component.theSLMiscTable}:theMiscUOM"
                                                        styleClass="input-lookup"
                                                        style="width: 100px"
                                                        secondaryDisplayField="Description__c"
                                                        minSearchLength="1"
                                                        stealFocus="true"
                                                        sObjectType="Sales_Line__c"
                                                        sObject="{!line}"
                                                        sObjectField="Unit_of_Measure__c"
                                                        onchange="validateFieldInList(this);"
                                                        
                                                        allowtoBlank="true"
                                                        LookupObject="Unit_of_Measure__c"
                                                        LinkFieldName="Name"
                                                        FieldSetName="UOMFieldSet"
                                                        RunValidation="True"
                                                        LookupType="ID"
                                                        ValidateFunction="validateField"
                                                        
                                                        fltr1="true"
                                                        fltr2="true"
                                                        fltr3="true"
                                                        fltr4="true"
                                                        fltr5="true"
                                                        fltr6="true"
                                                        fltr7="true"
                                                        />
                                    </div>
                                </apex:outputpanel>
                                <apex:outputField value="{!line.Unit_of_Measure__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Price__c.Label}">
                                <apex:inputField id="theMiscUnitPrice" value="{!line.Unit_Price__c}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="UnitPrice input-numeric" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Unit_Price__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>

                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Pricing_Source_2__c.Label}">
                                <apex:outputField value="{!line.Pricing_Source_2__c}"/>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Tax_Group__c.Label}">
                                <apex:inputField id="theMiscTaxGroup" value="{!line.Tax_Group__c}"
                                                 onchange="validateFieldInList(this)" style="width:60px"
                                                 styleClass="input-description" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Tax_Group__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Bill_as_Lump_Sum__c.Label}">
                                <apex:inputField id="theMiscBillasLumpSum" onChange="validateFieldInList(this)"
                                                 value="{!line.Bill_as_Lump_Sum__c}" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Bill_as_Lump_Sum__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Non_Billable__c.Label}">
                                <apex:inputField id="theMiscNonBillable" onChange="validateFieldInList(this)"
                                                 value="{!line.Non_Billable__c}" rendered="{!NOT(line.System_Calculated_Line__c) && open}"/>
                                <apex:outputField value="{!line.Non_Billable__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amount__c.Label}">
                                <apex:outputText id="theLineAmount" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amount__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Amt_Incl_Tax__c.Label}">
                                <apex:outputText id="theAmtInclTax" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Amt_Incl_Tax__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column rendered="{!salesOrder.From_Sales_Quote__c!=null}" headerValue="{!$ObjectType.Sales_Line__c.fields.Quote_Line__c.Label}">
                                <apex:inputField id="theQuoteLine" value="{!line.Quote_Line__c}" style="width: 100px" rendered="{!!line.System_Calculated_Line__c && open}"/>
                                <apex:outputField value="{!line.Quote_Line__c}" rendered="{!line.System_Calculated_Line__c || !open}" />
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Unit_Cost__c.Label}">
                                <apex:outputText id="theMiscUnitCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Unit_Cost__c}"/>
                                </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_Cost__c.Label}">
                                <apex:outputText id="theMiscLineCost" value="{0, number, ###,##0.00}"
                                                 styleClass="LineCost output-numeric" style="width:60px">
                                    <apex:param value="{!line.Line_Cost__c}"/>
                                </apex:outputText>
                            </apex:column> 
                            <apex:column headerValue="{!$ObjectType.Sales_Line__c.fields.Line_No__c.Label}">
                                <apex:outputField id="theLineNo" value="{!line.Line_No__c}" style="width:50px"/>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
                <apex:outputPanel >
                    <apex:commandButton value="Add Lines" action="{!insertLine}" reRender="theSLMiscTable,theMessage" disabled="{!!open}">
                        <apex:param name="ObjectType" value="SalesLine"/>
                        <apex:param name="LineCategory" value="Misc. Charges And Taxes"/>
                    </apex:commandButton>
                <div style="float:right;width:750px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                    <apex:pageBlockSection id="SLMiscTotal" columns="5">
                        <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotalMisc}"/>
                        </apex:outputText>
                        <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                            <apex:param value="{!SLProfitMarginMisc}"/>
                        </apex:outputText>
                        <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTotalCostMisc}"/>
                        </apex:outputText>
                        <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotalMisc}"/>
                        </apex:outputText>
                        <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotalMisc}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>
                <div style="clear:both;">
                </div>

                <apex:outputPanel >
                    <div style="float:right;width:950px;font-size:120%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold;">
                        <apex:pageBlockSection id="SLTotal" columns="6" title="Invoice Totals" collapsible="false">
                
                            <apex:outputText value="Surcharge Amount: {0, number, ###,##0.00}" style="color:#4a4a56;">
                                <apex:param value="{!SurchargeAmount}"/>
                            </apex:outputText>
                            <apex:outputText value="SubTotal: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLSubtotal}"/>
                        </apex:outputText>
                            <apex:outputText value="Profit Margin: {0, number, ###,##0.00}%" style="color:#4a4a56;">
                                <apex:param value="{!SLProfitMargin}"/>
                            </apex:outputText>
                            <apex:outputText value="Total Cost: {0, number, ###,##0.00}" style="color:#4a4a56;">
                                <apex:param value="{!SLTotalCost}"/>
                            </apex:outputText>
                            <apex:outputText value="Tax: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLTaxTotal}"/>
                        </apex:outputText>
                            <apex:outputText value="Total: {0, number, ###,##0.00}" style="color:#4a4a56;">
                            <apex:param value="{!SLtotal}"/>
                        </apex:outputText>
                    </apex:pageBlockSection>
                </div>
                </apex:outputPanel>

                <div style="clear:both;">
                </div>

                <apex:pageBlock title="Assumptions & Contingencies (Uncheck If N/A)" rendered="{!salesOrder.Document_Type__c=='Sales Order'}">
                    <apex:pageBlockSection id="theLaborAssumptions" columns="1" title="Labor Related Assumptions"
                                           collapsible="true" rendered="{!salesOrder.Contract__r.Billing_Rule__c == null}">
                        <apex:selectRadio style="margin-left:-11px !important" layout="pageDirection" value="{!LaborAssumption}">
                            <apex:selectOptions value="{!LaborAssumptionItems}"/>
                        </apex:selectRadio>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection columns="1" title="Labor Related Assumptions"
                                           collapsible="true" rendered="{!salesOrder.Contract__r.Billing_Rule__c != null}">
                        Billing Rule - {!salesOrder.Contract__r.Billing_Rule__r.Name} from contract {!salesOrder.Contract__r.ContractNumber}-{!salesOrder.Contract__r.Name} applied.
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="theTermsAndConditions" columns="1" title="Terms & Conditions (Uncheck if N/A)"
                                           rendered="{!salesOrder.Document_Type__c=='Sales Order'}" collapsible="true">
                        <apex:panelGrid columns="2" cellPadding="0" width="100%" style="margin-left:5px;" rowClasses="tcTableRow">
                            <apex:inputCheckbox value="{!salesOrder.Manifest_And_Profile__c}" id="chkManifestAndProfile"/>
                            <apex:outputLabel value="Manifest and Profile preparation require a $25.00 dollar fee for the first waste product. An additional $5.00 dollar will be
                                                        incurred for each additional waste product up to four total waste products per manifest or Bill of Lading. In addition, profile
                                                        fees from disposal facilities are charged at invoice cost plus 30%." for="chkManifestAndProfile"/>
                        </apex:panelGrid>
                    </apex:pageBlockSection>
                </apex:pageBlock>
                
                <apex:pageBlock title="Assumptions & Contingencies (Uncheck If N/A)" rendered="{!salesOrder.Document_Type__c=='Sales Quote'}">
                    <apex:pageBlockSection columns="1" id="theStandardAssumptions" title="Standard Assumptions/Contingencies"
                                           collapsible="true">
                        <apex:panelGrid columns="1" cellpadding="5" width="100%">
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Free_Access__c}" id="chkFreeAccess"/>
                                <apex:outputLabel value="ACV Enviro will have free and easy access to the work area." for="chkFreeAccess"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Pricing__c}" id="chkPricing"/>
                                <apex:outputLabel value="Pricing is based on work being completed during normal business hours Monday - Friday." for="chkPricing"/>    
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Expendables__c}" id="chkExpendables"/>
                                <apex:outputLabel value="Any expendables used are charged in accordance with ACV Enviro's current expendable price list." for="chkExpendables"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Applicable_Taxes__c}" id="chkApplicableTaxes"/>
                                <apex:outputLabel value="Applicable local, state, federal, transporter and/or other applicable taxes or fees will be added to the invoice." for="chkApplicableTaxes"/>
                            </apex:outputPanel>
                        </apex:panelGrid>
                    </apex:pageBlockSection>
                    
                    <apex:pageBlockSection id="theLaborAssumptions" columns="1" title="Labor Related Assumptions"
                                           collapsible="true" rendered="{!salesOrder.Contract__r.Billing_Rule__c == null}">
                        <apex:selectRadio style="margin-left:-11px !important" layout="pageDirection" value="{!LaborAssumption}">
                            <apex:selectOptions value="{!LaborAssumptionItems}"/>
                        </apex:selectRadio>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection columns="1" title="Labor Related Assumptions"
                                           collapsible="true" rendered="{!salesOrder.Contract__r.Billing_Rule__c != null}">
                        Billing Rule - {!salesOrder.Contract__r.Billing_Rule__r.Name} from contract {!salesOrder.Contract__r.ContractNumber}-{!salesOrder.Contract__r.Name} applied.
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="theDisposalAssumptions" columns="1" title="Disposal Related Assumptions/Contigencies (Uncheck all if no disposal)"
                                           collapsible="true" rendered="{!salesOrder.Document_Type__c=='Sales Quote'}">
                        <apex:panelGrid columns="1" cellpadding="5" width="100%">
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Minimum_Disposal_Fee__c}" id="chkMinmDisposalFee"/>
                                <apex:outputLabel value="There is a minimum disposal fee of $975.00 per shipment." for="chkMinmDisposalFee"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Disposal_Pricing__c}" id="chkDisposalPricing"/>
                                <apex:outputLabel value="Disposal Pricing is based on profile and analytical review and acceptance." for="chkDisposalPricing"/>    
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.First_Hour_Of_Loading__c}" id="chkFirstHourOfLoading"/>
                                <apex:outputLabel value="The first hour of loading is free; thereafter demurrage is $126.00 per hour." for="chkFirstHourOfLoading"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Invoice_Of_Work__c}" id="chkInvoiceOfWork"/>
                                <apex:outputLabel value="The invoice for referenced above may be generated before final disposal information has been received. If your waste is classified as 
                                                         off-specification upon receipt, you will be notified, and an additional invoice will be generated for any unexpected costs." for="chkInvoiceOfWork"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Minimum_Disposal_Charge__c}" id="chkMinmDisposalCharge"/>
                                <apex:outputLabel value="There is a 15 ton minimum disposal charge per load." for="chkMinmDisposalCharge"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Maximum_Weight__c}" id="chkMaximumweight"/>
                                <apex:outputLabel value="There is a maximum weight of 18 tons per roll-off container." for="chkMaximumweight"/>
                            </apex:outputPanel>
                            <apex:outputPanel >
                                <apex:inputCheckbox value="{!salesOrder.Off_Specification__c}" id="chkOffSpecification"/>
                                <apex:outputLabel value="Off-specification charges will apply if waste does not meet expected specifications." for="chkOffSpecification"/>
                            </apex:outputPanel>
                        </apex:panelGrid>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="theTermsAndConditions" columns="1" title="Terms & Conditions (Uncheck if N/A)"
                                           rendered="{!salesOrder.Document_Type__c=='Sales Quote'}" collapsible="true">
                        <apex:panelGrid columns="2" cellPadding="0" width="100%" style="margin-left:5px;" rowClasses="tcTableRow">
                            <apex:inputCheckbox value="{!salesOrder.Any_Deviations__c}" id="chkAnyDeviations"/>
                            <apex:outputLabel value="This quoted estimate is provided based upon information provided by or gathered at customers location. Any deviations
                                                        from this quotation will be invoiced based upon actual labor, materials, and/or disposal services provided by ACV and will
                                                        be billed at a time and materials basis." for="chkAnyDeviations"/>


                            <apex:inputCheckbox value="{!salesOrder.Shippable_Containers__c}" id="chkShippable"/>
                            <apex:outputLabel value="This quotation is contingent upon customer providing free and easy access to the work area. Drums/containers must be in
                                                        DOT shippable containers." for="chkShippable"/>


                            <apex:inputCheckbox value="{!salesOrder.First_Hour_Of_Loading__c}" id="chkSFirstHourOfLoadingInTC"/>
                            <apex:outputLabel value="The first hour of loading/unloading is at no charge; thereafter, demurrage rates apply at $126.00 / hr."
                                              for="chkSFirstHourOfLoadingInTC"/>


                            <apex:inputCheckbox value="{!salesOrder.Overtime_Rate_Description__c}" id="chkOvertimeRateDescription"/>
                            <apex:outputLabel value="An overtime rate of 1.5 times the listed rate will be charged for hours worked over 8 hours in a day, all hours before 7:00
                                                        am, after 3:30pm, on weekdays and allday Saturday. Double time will apply to all hours worked on Sunday and ACV
                                                        Holidays. ACV Holidays include:
                                                        New Year's Day, President's Day, Memorial Day, Independence Day, Labor Day, Thanksgiving Day,
                                                        The day after Thanksgiving, and Christmas Day." for="chkOvertimeRateDescription"/>


                            <apex:inputCheckbox value="{!salesOrder.Rate_Time_Definitions__c}" id="chkRateTimeDefinitions"/>
                            <apex:outputLabel value="Rate Time Definitions a. The day rate, where applicable, is defined as twelve hours.
                                                        b. After 12 hours and up to 24 hours, the Hourly Rate will apply. If no Hourly Rate is stated in the
                                                        Rate sheet for an item, it will be calculated as the Day Rate divided by 12." for="chkRateTimeDefinitions"/>


                            <apex:inputCheckbox value="{!salesOrder.Charges_For_Labor__c}" id="chkChargesForLabor"/>
                            <apex:outputLabel value="Charges for labor and equipment will be invoiced on a portal to portal basis from start to completion of the job, for loading
                                                        and unloading and mobilization and demobilization of equipment and materials. Minimum call out time is four hours per
                                                        person and per piece of equipment. This includes onsite and offsite labor and equipment." for="chkChargesForLabor"/>

                            <apex:inputCheckbox value="{!salesOrder.Waste_Disposal_And_Ancillary__c}" id="chkWasteDisposalAndAncillary"/>
                            <apex:outputLabel value="Waste disposal and/or ancillary supplies not listed on this quote will be quoted after a representative sample is obtained
                                                        and an approved TSDF is located (for waste); Ancillary supplies required and used will be billed in accordance with ACV
                                                        standard rates sheet." for="chkWasteDisposalAndAncillary"/>

                            <apex:inputCheckbox value="{!salesOrder.Characterization_Of_Waste__c}" id="chkCharaterizationOfWaste"/>
                            <apex:outputLabel value="This quotation is based on the generators characterization of the waste and the ACV assigned Process Code. Waste
                                                        materials that are received and do not conform to the assigned Process Code may be subject to re-coding and correction of
                                                        charges." for="chkCharaterizationOfWaste"/>

                            <apex:inputCheckbox value="{!salesOrder.Generate_Before_Final__c}" id="chkGenerateBeforeFinal"/>
                            <apex:outputLabel value="The invoice for work referenced above may be generated before final disposal information has been received. If your waste
                                                        is classified as off-specification upon receipt, you will be notified, and an additional invoice will be generated for any
                                                        unexpected costs." for="chkGenerateBeforeFinal"/>

                            <apex:inputCheckbox value="{!salesOrder.Lab_Packs_Rate__c}" id="chkLabPacksRate"/>
                            <apex:outputLabel value="Lab packs rates do not include explosives, potentially explosive, radioactive, temperature sensitive or infectious material;
                                                        ACV may furnish a separate quotation for any high-hazard work, if requested. ACV reserves the right to decline receipt of
                                                        any material that cannot be disposed of in a lawful manner or if no legal disposal options exist." for="chkLabPacksRate"/>

                            <apex:inputCheckbox value="{!salesOrder.Cylinders_Require_Evaluation__c}" id="chkCylindersRequireEvaluation"/>
                            <apex:outputLabel value="Cylinders require evaluation and approval by an authorized ACV representative prior to shipment. Cylinders must be in
                                                        DOT shippable condition, be marked with original stenciling, labels and/or tags, and valves must be operational. Cylinders
                                                        not meeting ACV approval and the aforementioned conditions may be subject to additional charges." for="chkCylindersRequireEvaluation"/>

                            <apex:inputCheckbox value="{!salesOrder.Manifest_And_Profile__c}" id="chkManifestAndProfile"/>
                            <apex:outputLabel value="Manifest and Profile preparation require a $25.00 dollar fee for the first waste product. An additional $5.00 dollar will be
                                                        incurred for each additional waste product up to four total waste products per manifest or Bill of Lading. In addition, profile
                                                        fees from disposal facilities are charged at invoice cost plus 30%." for="chkManifestAndProfile"/>

                            <apex:inputCheckbox value="{!salesOrder.Net_Due_Day__c}" id="chkNetDueDay"/>
                            <apex:outputLabel value="Net due {!Sales_Order__c.Payment_Term__r.Name} days with prior credit approval unless modified by executed purchase order or contract. Finance charges of
                                                        one and one half (1.5) percent per month will be due on payments past due after thirty days from date of invoice." for="chkNetDueDay"/>

                            <apex:inputCheckbox value="{!salesOrder.Applicable_Taxes_Quote__c}" id="chkApplicableTaxesQuote"/>
                            <apex:outputLabel value="Applicable Taxes, including local, state and federal taxes and/ or fees are not included in the quoted rates and will be
                                                        applied to each invoice as applicable." for="chkApplicableTaxesQuote"/>

                            <apex:inputCheckbox value="{!salesOrder.Client_Is_Responsible__c}" id="chkClientIsResponsible"/>
                            <apex:outputLabel value="Client is responsible for time, material, and disposal charges to decontaminate utilized equipment if necessary. Said
                                                        charges will be at ACV standard T&M rates and disposal cost plus 30%" for="chkClientIsResponsible"/>

                            <apex:inputCheckbox value="{!salesOrder.In_The_Event__c}" id="chkInTheEvent"/>
                            <apex:outputLabel value="In the event legal or other action is required to collect unpaid invoice balances, Customer agrees to pay all costs of
                                                        collection, including reasonable attorneys fees and agrees to the laws, jurisdiction, and venue of the state of New Jersey." for="chkInTheEvent"/>

                            <apex:inputCheckbox value="{!salesOrder.Quote_Valid_30__c}" id="chkQuoteValid30"/>
                            <apex:outputLabel value="This Quotation is valid for 30 days. Pricing is based on the current market capacity, conditions, and Government
                                                        regulations. If a significant market-wide pricing, capacity or regulatory change affects our pricing, this quotation is subject to
                                                        change." for="chkQuoteValid30"/>

                            <apex:inputCheckbox value="{!salesOrder.Unless_Superseded__c}" id="chkUnlessSuperseded"/>
                            <apex:outputLabel value="Unless superseded by a fully executed agreement with terms that conflict, additional terms & conditions located at
                                                        https://www.acvenviro.com/terms-and-conditions/ are hereby incorporated by reference and are agreed to and
                                                        acknowledged by customer." for="chkUnlessSuperseded"/>
                    
                        </apex:panelGrid>
                    </apex:pageBlockSection>
                    <apex:pageBlockSection id="theCustomAssumptions" columns="2" title="Custom Assumptions/Contingencies."
                                           collapsible="true" rendered="{!salesOrder.Document_Type__c=='Sales Quote'}">
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions1__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions6__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions2__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions7__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions3__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions8__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions4__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions9__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions5__c}" style="width:100%; height: 60px"/>
                        <apex:inputField rendered="{!open}" value="{!salesorder.Custom_Assumptions10__c}" style="width:100%; height: 60px"/>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:actionRegion>
            <script>
                $(".salesLineWrap").css("max-width", (screen.width - 100));
            </script>
        </apex:pageBlock>
    </apex:form>
    <style>
        .salesLineWrap {
            max-height: 400px !important;
            overflow: scroll;
        }
        tr.tcTableRow>td {padding-bottom: 10px;}
    </style>
    -->
</apex:page>